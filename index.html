<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Конвертер координат Lat/Lon ↔ UTM ↔ MGRS</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.8.0/proj4.js"></script>
    <!-- Додаємо просту реалізацію MGRS -->
    <script>
        // Проста реалізація MGRS конвертації
        function convertToMGRS(lat, lon) {
            // Визначаємо UTM зону
            const utmZone = Math.floor((lon + 180) / 6) + 1;
            
            // Конвертуємо в UTM
            const utmProj = `+proj=utm +zone=${utmZone} +datum=WGS84 +units=m +no_defs`;
            const [easting, northing] = proj4("WGS84", utmProj, [lon, lat]);
            
            // Визначаємо літерну позначку зони (спрощено)
            const latBands = 'CDEFGHJKLMNPQRSTUVWXX';
            const latIndex = Math.floor((lat + 80) / 8);
            const latBand = latBands[Math.min(Math.max(latIndex, 0), latBands.length - 1)];
            
            // Визначаємо 100км квадрат (спрощено)
            const e100k = Math.floor(easting / 100000);
            const n100k = Math.floor(northing / 100000);
            
            // Таблиці для літер 100км квадратів (спрощено)
            const eastingLetters = 'ABCDEFGHJKLMNPQRSTUVWXYZ';
            const northingLetters = 'ABCDEFGHJKLMNPQRSTUV';
            
            const eastingLetter = eastingLetters[e100k % eastingLetters.length];
            const northingLetter = northingLetters[n100k % northingLetters.length];
            
            // Координати в межах 100км квадрату
            const eastingRemainder = Math.floor(easting % 100000);
            const northingRemainder = Math.floor(northing % 100000);
            
            // Форматуємо результат (10-значний)
            const eastingStr = eastingRemainder.toString().padStart(5, '0');
            const northingStr = northingRemainder.toString().padStart(5, '0');
            
            return `${utmZone}${latBand}${eastingLetter}${northingLetter}${eastingStr}${northingStr}`;
        }
        
        function convertFromMGRS(mgrsString) {
            // Проста реалізація парсингу MGRS (базова)
            const match = mgrsString.match(/^(\d{1,2})([C-X])([A-Z])([A-Z])(\d{2,10})$/);
            if (!match) {
                throw new Error('Некоректний формат MGRS');
            }
            
            const [, zone, latBand, eastLetter, northLetter, coords] = match;
            
            // Розділяємо координати на easting та northing
            const coordLen = coords.length;
            if (coordLen % 2 !== 0) {
                throw new Error('Некоректна довжина координат');
            }
            
            const precision = coordLen / 2;
            const eastingStr = coords.substring(0, precision);
            const northingStr = coords.substring(precision);
            
            // Конвертуємо в повні UTM координати (спрощено)
            const easting = parseInt(eastingStr) * Math.pow(10, 5 - precision);
            const northing = parseInt(northingStr) * Math.pow(10, 5 - precision);
            
            // Конвертуємо з UTM в WGS84
            const utmProj = `+proj=utm +zone=${zone} +datum=WGS84 +units=m +no_defs`;
            const [lon, lat] = proj4(utmProj, "WGS84", [easting, northing]);
            
            return [lat, lon];
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            height: 100vh;
            overflow: hidden;
        }
        
        .main-container {
            display: flex;
            height: 100vh;
        }
        
        #map {
            flex: 1;
            height: 100%;
        }
        
        .control-panel {
            width: 400px;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-left: 1px solid rgba(0, 0, 0, 0.1);
            padding: 20px;
            overflow-y: auto;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
        }
        
        .control-panel h1 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        .input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 20px;
        }
        
        button {
            padding: 12px;
            font-size: 14px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .mgrs-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        
        .mgrs-section h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
        }
        
        .result-section {
            background-color: rgba(245, 245, 245, 0.9);
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            border: 1px solid #ddd;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .result-section strong {
            color: #333;
        }
        
        .result-section small {
            color: #666;
            font-style: italic;
        }
        
        .map-controls {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            color: #666;
        }
        
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            #map {
                height: 50%;
            }
            
            .control-panel {
                width: 100%;
                height: 50%;
            }
            
            .map-controls {
                top: auto;
                bottom: 10px;
                left: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Карта займає всю ліву частину -->
        <div id="map"></div>
        
        <!-- Контрольна панель справа -->
        <div class="control-panel">
            <h1>Конвертер координат</h1>
            
            <!-- Секція вводу Lat/Lon -->
            <div class="input-group">
                <label for="latInput">Широта:</label>
                <input type="text" id="latInput" placeholder="50.4501">
            </div>
            
            <div class="input-group">
                <label for="lonInput">Довгота:</label>
                <input type="text" id="lonInput" placeholder="30.5234">
            </div>
            
            <!-- Кнопки для конвертації -->
            <div class="button-group">
                <button onclick="convertLatLonToUTM()">→ UTM</button>
                <button onclick="convertLatLonToMGRS()">→ MGRS</button>
                <button onclick="convertLatLonToAll()">→ UTM + MGRS</button>
                <button onclick="showOnMap()">Показати на карті</button>
            </div>
            
            <!-- Секція MGRS -->
            <div class="mgrs-section">
                <h3>Конвертація з MGRS</h3>
                <div class="input-group">
                    <label for="mgrsInput">MGRS координати:</label>
                    <input type="text" id="mgrsInput" placeholder="36UYA1234567890">
                </div>
                <div class="button-group">
                    <button onclick="convertMGRSToLatLon()">→ Lat/Lon</button>
                </div>
            </div>
            
            <!-- Результати -->
            <div id="result" class="result-section" style="display: none;"></div>
        </div>
    </div>
    
    <!-- Інформація про карту -->
    <div class="map-controls">
        Клікніть на карту для отримання координат
    </div>
    
    <script>
        let map;
        let marker;
        
        // Ініціалізація карти
        function initMap() {
            // Координати Києва за замовчуванням
            const kyiv = { lat: 50.4501, lng: 30.5234 };
            
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 10,
                center: kyiv,
                mapTypeId: 'hybrid'
            });
            
            // Створюємо маркер
            marker = new google.maps.Marker({
                position: kyiv,
                map: map,
                title: 'Вибрана точка',
                draggable: true
            });
            
            // Обробник кліку по карті
            map.addListener('click', function(event) {
                const lat = event.latLng.lat();
                const lng = event.latLng.lng();
                
                // Оновлюємо поля вводу
                document.getElementById('latInput').value = lat.toFixed(6);
                document.getElementById('lonInput').value = lng.toFixed(6);
                
                // Переміщуємо маркер
                marker.setPosition(event.latLng);
                
                // Автоматично конвертуємо в усі формати
                convertLatLonToAll();
            });
            
            // Обробник перетягування маркера
            marker.addListener('dragend', function(event) {
                const lat = event.latLng.lat();
                const lng = event.latLng.lng();
                
                document.getElementById('latInput').value = lat.toFixed(6);
                document.getElementById('lonInput').value = lng.toFixed(6);
                
                convertLatLonToAll();
            });
        }
        
        // Define the projections
        proj4.defs("WGS84", "+proj=longlat +datum=WGS84 +no_defs");
        proj4.defs("UTM", "+proj=utm +zone=36 +datum=WGS84 +units=m +no_defs");
        
        function showResult(content) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = content;
            resultDiv.style.display = 'block';
        }
        
        function convertLatLonToUTM() {
            const lat = parseFloat(document.getElementById('latInput').value);
            const lon = parseFloat(document.getElementById('lonInput').value);
            
            if (isNaN(lat) || isNaN(lon)) {
                showResult('<strong>Помилка:</strong> введіть коректні значення широти та довготи');
                return;
            }
            
            try {
                const utmZone = Math.floor((lon + 180) / 6) + 1;
                const utmProj = `+proj=utm +zone=${utmZone} +datum=WGS84 +units=m +no_defs`;
                const [x, y] = proj4("WGS84", utmProj, [lon, lat]);
                
                showResult(`
                    <strong>UTM результат:</strong><br>
                    Зона: ${utmZone}<br>
                    Easting: ${x.toFixed(2)} м<br>
                    Northing: ${y.toFixed(2)} м<br>
                    UTM: ${utmZone} ${x.toFixed(2)} E, ${y.toFixed(2)} N
                `);
            } catch (error) {
                showResult('<strong>Помилка:</strong> при конвертації в UTM');
            }
        }
        
        function convertLatLonToMGRS() {
            const lat = parseFloat(document.getElementById('latInput').value);
            const lon = parseFloat(document.getElementById('lonInput').value);
            
            if (isNaN(lat) || isNaN(lon)) {
                showResult('<strong>Помилка:</strong> введіть коректні значення широти та довготи');
                return;
            }
            
            try {
                const mgrsCoord = convertToMGRS(lat, lon);
                
                showResult(`
                    <strong>MGRS результат:</strong><br>
                    MGRS: ${mgrsCoord}<br>
                    <small>Примітка: Це спрощена реалізація MGRS</small>
                `);
            } catch (error) {
                showResult('<strong>Помилка:</strong> при конвертації в MGRS - ' + error.message);
            }
        }
        
        function convertLatLonToAll() {
            const lat = parseFloat(document.getElementById('latInput').value);
            const lon = parseFloat(document.getElementById('lonInput').value);
            
            if (isNaN(lat) || isNaN(lon)) {
                showResult('<strong>Помилка:</strong> введіть коректні значення широти та довготи');
                return;
            }
            
            try {
                const utmZone = Math.floor((lon + 180) / 6) + 1;
                const utmProj = `+proj=utm +zone=${utmZone} +datum=WGS84 +units=m +no_defs`;
                const [x, y] = proj4("WGS84", utmProj, [lon, lat]);
                
                const mgrsCoord = convertToMGRS(lat, lon);
                
                showResult(`
                    <strong>Результати конвертації:</strong><br><br>
                    <strong>Вхідні дані:</strong><br>
                    Широта: ${lat}°<br>
                    Довгота: ${lon}°<br><br>
                    <strong>UTM:</strong><br>
                    Зона: ${utmZone}<br>
                    Easting: ${x.toFixed(2)} м<br>
                    Northing: ${y.toFixed(2)} м<br><br>
                    <strong>MGRS:</strong><br>
                    ${mgrsCoord}<br>
                    <small>Примітка: Це спрощена реалізація MGRS</small>
                `);
            } catch (error) {
                showResult('<strong>Помилка:</strong> при конвертації - ' + error.message);
            }
        }
        
        function convertMGRSToLatLon() {
            const mgrsInput = document.getElementById('mgrsInput').value.trim().toUpperCase();
            
            if (!mgrsInput) {
                showResult('<strong>Помилка:</strong> введіть MGRS координати');
                return;
            }
            
            try {
                const [lat, lon] = convertFromMGRS(mgrsInput);
                
                // Оновлюємо поля вводу
                document.getElementById('latInput').value = lat.toFixed(6);
                document.getElementById('lonInput').value = lon.toFixed(6);
                
                // Переміщуємо карту та маркер
                const position = new google.maps.LatLng(lat, lon);
                map.setCenter(position);
                marker.setPosition(position);
                
                const utmZone = Math.floor((lon + 180) / 6) + 1;
                const utmProj = `+proj=utm +zone=${utmZone} +datum=WGS84 +units=m +no_defs`;
                const [x, y] = proj4("WGS84", utmProj, [lon, lat]);
                
                showResult(`
                    <strong>Результат конвертації з MGRS:</strong><br><br>
                    <strong>Вхідні дані:</strong><br>
                    MGRS: ${mgrsInput}<br><br>
                    <strong>Lat/Lon:</strong><br>
                    Широта: ${lat.toFixed(6)}°<br>
                    Довгота: ${lon.toFixed(6)}°<br><br>
                    <strong>UTM:</strong><br>
                    Зона: ${utmZone}<br>
                    Easting: ${x.toFixed(2)} м<br>
                    Northing: ${y.toFixed(2)} м<br>
                    <small>Примітка: Це спрощена реалізація MGRS</small>
                `);
            } catch (error) {
                showResult('<strong>Помилка:</strong> некоректний формат MGRS або помилка конвертації - ' + error.message);
            }
        }
        
        function showOnMap() {
            const lat = parseFloat(document.getElementById('latInput').value);
            const lon = parseFloat(document.getElementById('lonInput').value);
            
            if (isNaN(lat) || isNaN(lon)) {
                showResult('<strong>Помилка:</strong> введіть коректні значення широти та довготи');
                return;
            }
            
            const position = new google.maps.LatLng(lat, lon);
            map.setCenter(position);
            map.setZoom(15);
            marker.setPosition(position);
        }
        
        // Ініціалізація при завантаженні сторінки
        document.addEventListener('DOMContentLoaded', function() {
            // Встановлюємо приклади координат Києва
            document.getElementById('latInput').value = '50.4501';
            document.getElementById('lonInput').value = '30.5234';
        });
    </script>
    
    <!-- Замініть YOUR_API_KEY на ваш реальний API ключ Google Maps -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBwGrlOp-k99i4mj_q7v9uTxzXmEF9-GWM&callback=initMap"></script>
</body>
</html>










