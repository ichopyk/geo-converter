<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç Lat/Lon ‚Üî UTM ‚Üî MGRS ‚Üî USNG</title>

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBwGrlOp-k99i4mj_q7v9uTxzXmEF9-GWM&callback=initMap"></script>

    <script src="mgrs.min.js"></script>
    <script src="proj4.js"></script>
    <style>
        /* –í–µ—Å—å –≤–∞—à CSS –∫–æ–¥ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –±–µ–∑ –∑–º—ñ–Ω */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            height: 100vh;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .main-container {
            display: flex;
            height: 100vh;
        }

        #map {
            flex: 1;
            height: 100%;
            position: relative;
        }

        .control-panel {
            width: 420px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-left: 1px solid rgba(0, 0, 0, 0.1);
            padding: 25px;
            overflow-y: auto;
            box-shadow: -5px 0 20px rgba(0, 0, 0, 0.15);
        }

        .control-panel h1 {
            font-size: 22px;
            margin-bottom: 25px;
            color: #2c3e50;
            text-align: center;
            font-weight: 600;
        }

        .input-group {
            margin-bottom: 18px;
        }

        .input-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #34495e;
            font-size: 14px;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .button-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 25px;
        }

        button {
            padding: 14px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .mgrs-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid #ecf0f1;
        }

        .mgrs-section h3 {
            margin-bottom: 18px;
            color: #2c3e50;
            font-size: 18px;
            font-weight: 600;
        }

        .result-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 1px solid #dee2e6;
            font-size: 14px;
            line-height: 1.6;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .result-section strong {
            color: #2c3e50;
        }

        .result-section small {
            color: #6c757d;
            font-style: italic;
        }

        .map-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .map-placeholder::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.3;
        }

        .map-controls {
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 12px;
            border-radius: 8px;
            font-size: 13px;
            color: #6c757d;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .quick-actions {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #ecf0f1;
        }

        .quick-actions h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 16px;
            font-weight: 600;
        }

        .quick-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .quick-btn {
            padding: 8px 12px;
            font-size: 12px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 80px;
        }

        .quick-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .format-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #ecf0f1;
        }

        .format-section h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 16px;
            font-weight: 600;
        }

        .format-examples {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            color: #6c757d;
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }

            #map {
                height: 40%;
            }

            .control-panel {
                width: 100%;
                height: 60%;
            }

            .map-controls {
                top: auto;
                bottom: 15px;
                left: 15px;
                right: 15px;
            }
        }

        .copy-btn {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3);
        }

        .error-message {
            color: #e74c3c;
            background: #ffebee;
            padding: 10px;
            border-radius: 6px;
            border-left: 4px solid #e74c3c;
        }

        .success-message {
            color: #27ae60;
            background: #e8f5e8;
            padding: 10px;
            border-radius: 6px;
            border-left: 4px solid #27ae60;
        }

        .utm-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid #ecf0f1;
        }

        .utm-section h3 {
            margin-bottom: 18px;
            color: #2c3e50;
            font-size: 18px;
            font-weight: 600;
        }

        .precision-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .precision-btn {
            padding: 6px 10px;
            font-size: 11px;
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .precision-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(142, 68, 173, 0.3);
        }

        .ddm-section, .dms-section, .usng-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid #ecf0f1;
        }
        .ddm-section h3, .dms-section h3, .usng-section h3 {
            margin-bottom: 18px;
            color: #2c3e50;
            font-size: 18px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div id="map">
            <div class="map-placeholder">
                <div>
                    <div style="margin-bottom: 10px;">üó∫Ô∏è –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –∫–∞—Ä—Ç–∞</div>
                    <div style="font-size: 14px; opacity: 0.8;">–ö–ª—ñ–∫–Ω—ñ—Ç—å –Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –¥–ª—è —ó—Ö –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è</div>
                </div>
            </div>
        </div>

        <div class="control-panel">
            <h1>–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç</h1>

            <div class="input-group">
                <label for="latInput">–®–∏—Ä–æ—Ç–∞ (DD):</label>
                <input type="text" id="latInput" placeholder="50.4501" oninput="validateInput()">
            </div>

            <div class="input-group">
                <label for="lonInput">–î–æ–≤–≥–æ—Ç–∞ (DD):</label>
                <input type="text" id="lonInput" placeholder="30.5234" oninput="validateInput()">
            </div>

            <div class="button-group">
                <button onclick="convertLatLonToUTM()">‚Üí UTM</button>
                <button onclick="convertLatLonToMGRS()">‚Üí MGRS</button>
                <button onclick="convertLatLonToUSNG()">‚Üí USNG</button>
                <button onclick="convertLatLonToDDM()">‚Üí DDM</button>
                <button onclick="convertLatLonToDMS()">‚Üí DMS</button>
                <button onclick="convertLatLonToAll()">‚Üí –í—Å—ñ —Ñ–æ—Ä–º–∞—Ç–∏</button>
                <button onclick="convertLatLonToAllPrecisions()">‚Üí MGRS (–≤—Å—ñ —Ç–æ—á–Ω–æ—Å—Ç—ñ)</button>
                <button onclick="showOnMapFromInputs()">–ü–æ–∫–∞–∑–∞—Ç–∏ –Ω–∞ –∫–∞—Ä—Ç—ñ</button>
            </div>

            <div class="utm-section">
                <h3>–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –∑ UTM</h3>
                <div class="input-group">
                    <label for="utmZoneInput">–ó–æ–Ω–∞ UTM:</label>
                    <input type="text" id="utmZoneInput" placeholder="36N">
                </div>
                <div class="input-group">
                    <label for="utmEastingInput">Easting:</label>
                    <input type="text" id="utmEastingInput" placeholder="123456">
                </div>
                <div class="input-group">
                    <label for="utmNorthingInput">Northing:</label>
                    <input type="text" id="utmNorthingInput" placeholder="5123456">
                </div>
                <div class="button-group">
                    <button onclick="convertUTMToLatLon()">‚Üí Lat/Lon (DD)</button>
                </div>
            </div>

            <div class="mgrs-section">
                <h3>–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –∑ MGRS</h3>
                <div class="input-group">
                    <label for="mgrsInput">MGRS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</label>
                    <input type="text" id="mgrsInput" placeholder="36UYA1234567890" oninput="validateMGRSInput()">
                </div>
                <div class="button-group">
                    <button onclick="convertMGRSToLatLon()">‚Üí Lat/Lon (DD)</button>
                </div>
            </div>

            <div class="usng-section">
                <h3>–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –∑ USNG</h3>
                <div class="input-group">
                    <label for="usngInput">USNG –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</label>
                    <input type="text" id="usngInput" placeholder="36U YA 12345 67890" oninput="validateUSNGInput()">
                </div>
                <div class="button-group">
                    <button onclick="convertUSNGToLatLon()">‚Üí Lat/Lon (DD)</button>
                </div>
            </div>

            <div class="ddm-section">
                <h3>–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –∑ DDM</h3>
                <div class="input-group">
                    <label for="ddmLatInput">–®–∏—Ä–æ—Ç–∞ (DDM):</label>
                    <input type="text" id="ddmLatInput" placeholder="50¬∞ 26.9725'N" oninput="validateDDMInput()">
                </div>
                <div class="input-group">
                    <label for="ddmLonInput">–î–æ–≤–≥–æ—Ç–∞ (DDM):</label>
                    <input type="text" id="ddmLonInput" placeholder="030¬∞ 31.5207'E" oninput="validateDDMInput()">
                </div>
                <div class="button-group">
                    <button onclick="convertDDMToLatLon()">‚Üí Lat/Lon (DD)</button>
                </div>
            </div>

            <div class="dms-section">
                <h3>–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –∑ DMS</h3>
                <div class="input-group">
                    <label for="dmsLatInput">–®–∏—Ä–æ—Ç–∞ (DMS):</label>
                    <input type="text" id="dmsLatInput" placeholder="50¬∞ 26' 58.35''N" oninput="validateDMSInput()">
                </div>
                <div class="input-group">
                    <label for="dmsLonInput">–î–æ–≤–≥–æ—Ç–∞ (DMS):</label>
                    <input type="text" id="dmsLonInput" placeholder="030¬∞ 31' 12.35''E" oninput="validateDMSInput()">
                </div>
                <div class="button-group">
                    <button onclick="convertDMSToLatLon()">‚Üí Lat/Lon (DD)</button>
                </div>
            </div>

            <div class="quick-actions">
                <h3>–®–≤–∏–¥–∫—ñ –¥—ñ—ó</h3>
                <div class="quick-buttons">
                    <button class="quick-btn" onclick="setKyivCoordinates()">–ö–∏—ó–≤</button>
                    <button class="quick-btn" onclick="setLvivCoordinates()">–õ—å–≤—ñ–≤</button>
                    <button class="quick-btn" onclick="setOdesaCoordinates()">–û–¥–µ—Å–∞</button>
                    <button class="quick-btn" onclick="clearInputs()">–û—á–∏—Å—Ç–∏—Ç–∏</button>
                    <button class="quick-btn location-btn" onclick="getCurrentLocation()">–ú–æ—î –º—ñ—Å—Ü–µ</button>
                </div>
            </div>

            <div class="format-section">
                <h3>–§–æ—Ä–º–∞—Ç–∏ –≤–≤–æ–¥—É</h3>
                <div class="format-examples">
                    <strong>Lat/Lon (DD):</strong> 50.4501, 30.5234<br>
                    <strong>UTM:</strong> 36N 123456 5123456<br>
                    <strong>MGRS:</strong> 36UYA1234567890<br>
                    <strong>USNG:</strong> 36U YA 12345 67890<br>
                    <strong>DDM:</strong> 50¬∞ 26.9725'N, 030¬∞ 31.5207'E<br>
                    <strong>DMS:</strong> 50¬∞ 26' 58.35''N, 030¬∞ 31' 12.35''E
                </div>
            </div>

            <div id="result" class="result-section" style="display: none;"></div>
        </div>
    </div>

    <div class="map-controls">
        üí° –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –±—É–¥—É—Ç—å –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω—ñ –Ω–∞ –∫–∞—Ä—Ç—ñ –ø—ñ—Å–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ –¥–ª—è Google Maps —Ç–∞ –º–∞—Ä–∫–µ—Ä–∞
        let map = null;
        let currentMarker = null;

        // --- –ì–ª–æ–±–∞–ª—å–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó ---
        // –£—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—ñ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å—Å—è –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –∑ HTML (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, onclick="myFunction()")
        // –∞–±–æ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å—Å—è —ñ–Ω—à–∏–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–∏–º–∏ —Ñ—É–Ω–∫—Ü—ñ—è–º–∏, –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –≤–∏–∑–Ω–∞—á–µ–Ω—ñ —Ç—É—Ç.

        // Callback —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è Google Maps API. –û–ë–û–í'–Ø–ó–ö–û–í–û –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ—é.
        function initMap() {
            // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –∫–∞—Ä—Ç–∏ –æ–¥—Ä–∞–∑—É, —è–∫ —Ç—ñ–ª—å–∫–∏ —Ñ—É–Ω–∫—Ü—ñ—è initMap –≤–∏–∫–ª–∏–∫–∞–Ω–∞
            const mapPlaceholder = document.querySelector('.map-placeholder');
            if (mapPlaceholder) {
                mapPlaceholder.style.display = 'none';
            }

            // –¶–µ–Ω—Ç—Ä –∫–∞—Ä—Ç–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ö–∏—ó–≤, –£–∫—Ä–∞—ó–Ω–∞)
            const defaultLatLng = { lat: 50.4501, lng: 30.5234 };

            map = new google.maps.Map(document.getElementById('map'), {
                center: defaultLatLng,
                zoom: 6, // –ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Ä—ñ–≤–µ–Ω—å –º–∞—Å—à—Ç–∞–±—É
                mapTypeId: 'roadmap' // –¢–∏–ø –∫–∞—Ä—Ç–∏: 'roadmap', 'satellite', 'hybrid', 'terrain'
            });

            // –î–æ–¥–∞—î–º–æ —Å–ª—É—Ö–∞—á –ø–æ–¥—ñ–π –¥–ª—è –∫–ª—ñ–∫—É –Ω–∞ –∫–∞—Ä—Ç—É
            map.addListener("click", (e) => {
                const clickedLat = e.latLng.lat();
                const clickedLon = e.latLng.lng();
                document.getElementById('latInput').value = clickedLat.toFixed(6);
                document.getElementById('lonInput').value = clickedLon.toFixed(6);
                validateInput(); // –í–∞–ª—ñ–¥—É—î–º–æ –≤–≤—ñ–¥ –ø—ñ—Å–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
                convertLatLonToAll(); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –ø–æ –∫–ª—ñ–∫—É
            });

            console.log("Google Maps initialized.");
        }

        // –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
        function showResult(content, isError = false) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = content;
            resultDiv.style.display = 'block';
            if (isError) {
                resultDiv.className = 'result-section error-message';
            } else {
                resultDiv.className = 'result-section';
            }
        }

        function addCopyButton(text, label) {
            // –ï–∫—Ä–∞–Ω—É—î–º–æ –æ–¥–∏–Ω–∞—Ä–Ω—ñ –ª–∞–ø–∫–∏ —É —Ç–µ–∫—Å—Ç—ñ –¥–ª—è –∞—Ç—Ä–∏–±—É—Ç—É onclick
            // –ó–∞–º—ñ–Ω—é—î–º–æ ' –Ω–∞ \'
            const escapedText = text.replace(/'/g, "\\'");
            return `<button class="copy-btn" onclick="copyToClipboard('${escapedText}')">${label}</button>`;
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                showTemporaryMessage('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!', 'success');
            }, function() {
                showTemporaryMessage('–ü–æ–º–∏–ª–∫–∞ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è', 'error');
            });
        }

        function showTemporaryMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
            messageDiv.textContent = message;
            messageDiv.style.position = 'fixed';
            messageDiv.style.top = '20px';
            messageDiv.style.right = '20px';
            messageDiv.style.zIndex = '9999';
            messageDiv.style.padding = '10px 20px';
            messageDiv.style.borderRadius = '8px';
            messageDiv.style.fontSize = '14px';
            messageDiv.style.fontWeight = '600';
            document.body.appendChild(messageDiv);
            setTimeout(() => {
                document.body.removeChild(messageDiv);
            }, 3000);
        }

        // –§—É–Ω–∫—Ü—ñ—ó –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –≤–≤–æ–¥—É
        function validateInput() {
            const lat = document.getElementById('latInput').value;
            const lon = document.getElementById('lonInput').value;
            if (lat) {
                const latNum = parseFloat(lat);
                if (isNaN(latNum) || latNum < -90 || latNum > 90) {
                    document.getElementById('latInput').style.borderColor = '#e74c3c';
                } else {
                    document.getElementById('latInput').style.borderColor = '#27ae60';
                }
            } else {
                document.getElementById('latInput').style.borderColor = '#e0e0e0';
            }
            if (lon) {
                const lonNum = parseFloat(lon);
                if (isNaN(lonNum) || lonNum < -180 || lonNum > 180) {
                    document.getElementById('lonInput').style.borderColor = '#e74c3c';
                } else {
                    document.getElementById('lonInput').style.borderColor = '#27ae60';
                }
            } else {
                document.getElementById('lonInput').style.borderColor = '#e0e0e0';
            }
        }

        function validateMGRSInput() {
            const mgrsInput = document.getElementById('mgrsInput').value.trim().toUpperCase();
            const mgrsPattern = /^[0-9]{1,2}[A-Z][A-Z]{2}[0-9]{2,10}$/;
            if (mgrsInput) {
                if (mgrsPattern.test(mgrsInput)) {
                    document.getElementById('mgrsInput').style.borderColor = '#27ae60';
                } else {
                    document.getElementById('mgrsInput').style.borderColor = '#e74c3c';
                }
            } else {
                document.getElementById('mgrsInput').style.borderColor = '#e0e0e0';
            }
        }

        function validateUSNGInput() {
            const usngInput = document.getElementById('usngInput').value.trim().toUpperCase();
            // USNG pattern similar to MGRS but allows spaces
            const usngPattern = /^[0-9]{1,2}[A-Z]\s?[A-Z]{2}\s?[0-9]{2}([0-9]{2})?([0-9]{2})?([0-9]{2})?([0-9]{2})?$/;
            if (usngInput) {
                if (usngPattern.test(usngInput)) {
                    document.getElementById('usngInput').style.borderColor = '#27ae60';
                } else {
                    document.getElementById('usngInput').style.borderColor = '#e74c3c';
                }
            } else {
                document.getElementById('usngInput').style.borderColor = '#e0e0e0';
            }
        }

        function validateUTMInput() {
            const zone = document.getElementById('utmZoneInput').value.trim();
            const easting = parseFloat(document.getElementById('utmEastingInput').value);
            const northing = parseFloat(document.getElementById('utmNorthingInput').value);
            const zonePattern = /^[0-9]{1,2}[NnSs]$/;
            if (zone) {
                if (zonePattern.test(zone)) {
                    document.getElementById('utmZoneInput').style.borderColor = '#27ae60';
                } else {
                    document.getElementById('utmZoneInput').style.borderColor = '#e74c3c';
                }
            } else {
                document.getElementById('utmZoneInput').style.borderColor = '#e0e0e0';
            }
            if (easting) {
                const eastingNum = parseFloat(easting);
                if (isNaN(eastingNum) || eastingNum < 100000 || eastingNum > 900000) {
                    document.getElementById('utmEastingInput').style.borderColor = '#e74c3c';
                } else {
                    document.getElementById('utmEastingInput').style.borderColor = '#27ae60';
                }
            } else {
                document.getElementById('utmEastingInput').style.borderColor = '#e0e0e0';
            }
            if (northing) {
                const northingNum = parseFloat(northing);
                if (isNaN(northingNum) || northingNum < 0 || northingNum > 10000000) {
                    document.getElementById('utmNorthingInput').style.borderColor = '#e74c3c';
                } else {
                    document.getElementById('utmNorthingInput').style.borderColor = '#27ae60';
                }
            } else {
                document.getElementById('utmNorthingInput').style.borderColor = '#e0e0e0';
            }
        }

        function validateDDMInput() {
            const lat = document.getElementById('ddmLatInput').value.trim();
            const lon = document.getElementById('ddmLonInput').value.trim();
            // Regex –¥–ª—è DDM: –¥–æ–∑–≤–æ–ª—è—î –≤—ñ–¥'—î–º–Ω—ñ –≥—Ä–∞–¥—É—Å–∏, –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –ø—Ä–æ–±—ñ–ª–∏, —ñ 'N/S/E/W' –≤ –∫—ñ–Ω—Ü—ñ
            const ddmPattern = /^-?\d{1,3}¬∞\s*\d{1,2}\.\d+'[NSWE]$/i;

            if (lat) {
                if (ddmPattern.test(lat)) {
                    document.getElementById('ddmLatInput').style.borderColor = '#27ae60';
                } else {
                    document.getElementById('ddmLatInput').style.borderColor = '#e74c3c';
                }
            } else {
                document.getElementById('ddmLatInput').style.borderColor = '#e0e0e0';
            }
            if (lon) {
                if (ddmPattern.test(lon)) {
                    document.getElementById('ddmLonInput').style.borderColor = '#27ae60';
                } else {
                    document.getElementById('ddmLonInput').style.borderColor = '#e74c3c';
                }
            } else {
                document.getElementById('ddmLonInput').style.borderColor = '#e0e0e0';
            }
        }

        function validateDMSInput() {
            const lat = document.getElementById('dmsLatInput').value.trim();
            const lon = document.getElementById('dmsLonInput').value.trim();
            // Regex –¥–ª—è DMS: –¥–æ–∑–≤–æ–ª—è—î –≤—ñ–¥'—î–º–Ω—ñ –≥—Ä–∞–¥—É—Å–∏, –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –ø—Ä–æ–±—ñ–ª–∏, '' –¥–ª—è —Å–µ–∫—É–Ω–¥, —ñ 'N/S/E/W' –≤ –∫—ñ–Ω—Ü—ñ
            const dmsPattern = /^-?\d{1,3}¬∞\s*\d{1,2}'\s*\d{1,2}(?:\.\d+)?''[NSWE]$/i;

            if (lat) {
                if (dmsPattern.test(lat)) {
                    document.getElementById('dmsLatInput').style.borderColor = '#27ae60';
                } else {
                    document.getElementById('dmsLatInput').style.borderColor = '#e74c3c';
                }
            } else {
                document.getElementById('dmsLatInput').style.borderColor = '#e0e0e0';
            }
            if (lon) {
                if (dmsPattern.test(lon)) {
                    document.getElementById('dmsLonInput').style.borderColor = '#27ae60';
                } else {
                    document.getElementById('dmsLonInput').style.borderColor = '#e74c3c';
                }
            } else {
                document.getElementById('dmsLonInput').style.borderColor = '#e0e0e0';
            }
        }


        // –§—É–Ω–∫—Ü—ñ—ó –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
        function getUtmProjString(zone, hemisphere) {
            const zoneNum = parseInt(zone);
            const south = hemisphere.toUpperCase() === 'S' ? ' +south' : '';
            return `+proj=utm +zone=${zoneNum} +ellps=WGS84 +datum=WGS84 +units=m +no_defs${south}`;
        }

        function convertLatLonToUTM() {
            console.log("convertLatLonToUTM called"); // –î–ª—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è
            const lat = parseFloat(document.getElementById('latInput').value);
            const lon = parseFloat(document.getElementById('lonInput').value);
            if (isNaN(lat) || lat < -90 || lat > 90 || isNaN(lon) || lon < -180 || lon > 180) {
                showResult('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –¥—ñ–π—Å–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ Lat/Lon (-90 –¥–æ 90, -180 –¥–æ 180).', true);
                console.warn("Invalid Lat/Lon for UTM conversion");
                return;
            }
            if (typeof proj4 === 'undefined') {
                showResult('–ü–æ–º–∏–ª–∫–∞: –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ Proj4js –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è UTM –Ω–µ–º–æ–∂–ª–∏–≤–∞.', true);
                console.error("Proj4js library is undefined in convertLatLonToUTM");
                return;
            }
            try {
                console.log("Attempting UTM conversion for:", lat, lon);
                const zone = Math.floor((lon + 180) / 6) + 1;
                const hemisphere = lat >= 0 ? 'N' : 'S';
                const utmProj = proj4(getUtmProjString(zone, hemisphere));
                const [easting, northing] = utmProj.forward([lon, lat]);
                const result = `
                    <h3>UTM –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</h3>
                    <p><strong>–ó–æ–Ω–∞:</strong> ${zone}${hemisphere} ${addCopyButton(`${zone}${hemisphere}`, '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                    <p><strong>Easting:</strong> ${easting.toFixed(2)} ${addCopyButton(easting.toFixed(2), '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                    <p><strong>Northing:</strong> ${northing.toFixed(2)} ${addCopyButton(northing.toFixed(2), '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                `;
                showResult(result);
                showOnMap(lat, lon);
            } catch (error) {
                console.error("UTM Conversion Error:", error);
                showResult(`–ü–æ–º–∏–ª–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó Lat/Lon –≤ UTM: ${error.message}`, true);
            }
        }

        function convertLatLonToMGRS() {
            console.log("convertLatLonToMGRS called"); // –î–ª—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è
            const lat = parseFloat(document.getElementById('latInput').value);
            const lon = parseFloat(document.getElementById('lonInput').value);
            if (isNaN(lat) || lat < -90 || lat > 90 || isNaN(lon) || lon < -180 || lon > 180) {
                showResult('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –¥—ñ–π—Å–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ Lat/Lon (-90 –¥–æ 90, -180 –¥–æ 180).', true);
                console.warn("Invalid Lat/Lon for MGRS conversion");
                return;
            }
            if (typeof mgrs === 'undefined') {
                showResult('–ü–æ–º–∏–ª–∫–∞: –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ MGRS –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è MGRS –Ω–µ–º–æ–∂–ª–∏–≤–∞.', true);
                console.error("MGRS library is undefined in convertLatLonToMGRS");
                return;
            }
            try {
                console.log("Attempting MGRS conversion for:", lat, lon);
                const mgrsCoord = mgrs.forward([lon, lat], 5);
                const result = `
                    <h3>MGRS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</h3>
                    <p><strong>MGRS:</strong> ${mgrsCoord} ${addCopyButton(mgrsCoord, '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                `;
                showResult(result);
                showOnMap(lat, lon);
            } catch (error) {
                console.error("MGRS Conversion Error (LatLon to MGRS):", error);
                showResult(`–ü–æ–º–∏–ª–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó Lat/Lon –≤ MGRS: ${error.message}`, true);
            }
        }

        // Helper function to format MGRS string to USNG with spaces
        function formatMGRSToUSNG(mgrsString) {
            if (!mgrsString || mgrsString.length < 5) return mgrsString;
            const zoneBand = mgrsString.substring(0, 3); // e.g., 36U
            const gridSquare = mgrsString.substring(3, 5); // e.g., YA
            const eastingNorthing = mgrsString.substring(5); // e.g., 1234567890

            let formatted = zoneBand + ' ' + gridSquare;
            // Add spaces every 5 digits for easting/northing if present
            if (eastingNorthing.length > 0) {
                const halfLength = eastingNorthing.length / 2;
                formatted += ' ' + eastingNorthing.substring(0, halfLength);
                if (halfLength < eastingNorthing.length) {
                    formatted += ' ' + eastingNorthing.substring(halfLength);
                }
            }
            return formatted;
        }

        function convertLatLonToUSNG() {
            console.log("convertLatLonToUSNG called");
            const lat = parseFloat(document.getElementById('latInput').value);
            const lon = parseFloat(document.getElementById('lonInput').value);
            if (isNaN(lat) || lat < -90 || lat > 90 || isNaN(lon) || lon < -180 || lon > 180) {
                showResult('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –¥—ñ–π—Å–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ Lat/Lon (-90 –¥–æ 90, -180 –¥–æ 180).', true);
                return;
            }
            if (typeof mgrs === 'undefined') {
                showResult('–ü–æ–º–∏–ª–∫–∞: –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ MGRS –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è USNG –Ω–µ–º–æ–∂–ª–∏–≤–∞.', true);
                return;
            }
            try {
                // USNG is MGRS with 1-meter precision (5 digits for easting/northing)
                const mgrsCoord = mgrs.forward([lon, lat], 5); 
                const usngCoord = formatMGRSToUSNG(mgrsCoord);
                const result = `
                    <h3>USNG –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</h3>
                    <p><strong>USNG:</strong> ${usngCoord} ${addCopyButton(usngCoord, '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                `;
                showResult(result);
                showOnMap(lat, lon);
            } catch (error) {
                console.error("USNG Conversion Error:", error);
                showResult(`–ü–æ–º–∏–ª–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó Lat/Lon –≤ USNG: ${error.message}`, true);
            }
        }

        function convertLatLonToDDM() {
            console.log("convertLatLonToDDM called");
            const lat = parseFloat(document.getElementById('latInput').value);
            const lon = parseFloat(document.getElementById('lonInput').value);
            if (isNaN(lat) || lat < -90 || lat > 90 || isNaN(lon) || lon < -180 || lon > 180) {
                showResult('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –¥—ñ–π—Å–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ Lat/Lon (-90 –¥–æ 90, -180 –¥–æ 180).', true);
                return;
            }

            try {
                const latAbs = Math.abs(lat);
                const latDeg = Math.floor(latAbs);
                const latMin = (latAbs - latDeg) * 60;
                const latDir = lat >= 0 ? 'N' : 'S';
                const ddmLat = `${latDeg}¬∞ ${latMin.toFixed(4)}'${latDir}`;

                const lonAbs = Math.abs(lon);
                const lonDeg = Math.floor(lonAbs);
                const lonMin = (lonAbs - lonDeg) * 60;
                const lonDir = lon >= 0 ? 'E' : 'W';
                const ddmLon = `${lonDeg}¬∞ ${lonMin.toFixed(4)}'${lonDir}`;

                const result = `
                    <h3>DDM –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</h3>
                    <p><strong>–®–∏—Ä–æ—Ç–∞ (DDM):</strong> ${ddmLat} ${addCopyButton(ddmLat, '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                    <p><strong>–î–æ–≤–≥–æ—Ç–∞ (DDM):</strong> ${ddmLon} ${addCopyButton(ddmLon, '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                `;
                showResult(result);
                showOnMap(lat, lon);
            } catch (error) {
                console.error("DDM Conversion Error:", error);
                showResult(`–ü–æ–º–∏–ª–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó Lat/Lon –≤ DDM: ${error.message}`, true);
            }
        }

        function convertLatLonToDMS() {
            console.log("convertLatLonToDMS called");
            const lat = parseFloat(document.getElementById('latInput').value);
            const lon = parseFloat(document.getElementById('lonInput').value);
            if (isNaN(lat) || lat < -90 || lat > 90 || isNaN(lon) || lon < -180 || lon > 180) {
                showResult('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –¥—ñ–π—Å–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ Lat/Lon (-90 –¥–æ 90, -180 –¥–æ 180).', true);
                return;
            }

            try {
                const toDMS = (coord, isLat) => {
                    const absCoord = Math.abs(coord);
                    const degrees = Math.floor(absCoord);
                    const minutesFloat = (absCoord - degrees) * 60;
                    const minutes = Math.floor(minutesFloat);
                    const seconds = (minutesFloat - minutes) * 60;
                    let direction;
                    if (isLat) {
                        direction = coord >= 0 ? 'N' : 'S';
                    } else {
                        direction = coord >= 0 ? 'E' : 'W';
                    }
                    return `${degrees}¬∞ ${minutes}' ${seconds.toFixed(2)}''${direction}`;
                };

                const dmsLat = toDMS(lat, true);
                const dmsLon = toDMS(lon, false);

                const result = `
                    <h3>DMS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</h3>
                    <p><strong>–®–∏—Ä–æ—Ç–∞ (DMS):</strong> ${dmsLat} ${addCopyButton(dmsLat, '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                    <p><strong>–î–æ–≤–≥–æ—Ç–∞ (DMS):</strong> ${dmsLon} ${addCopyButton(dmsLon, '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                `;
                showResult(result);
                showOnMap(lat, lon);
            } catch (error) {
                console.error("DMS Conversion Error:", error);
                showResult(`–ü–æ–º–∏–ª–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó Lat/Lon –≤ DMS: ${error.message}`, true);
            }
        }

        function convertLatLonToAll() {
            console.log("convertLatLonToAll called"); // –î–ª—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è
            const lat = parseFloat(document.getElementById('latInput').value);
            const lon = parseFloat(document.getElementById('lonInput').value);
            if (isNaN(lat) || lat < -90 || lat > 90 || isNaN(lon) || lon < -180 || lon > 180) {
                showResult('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –¥—ñ–π—Å–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ Lat/Lon (-90 –¥–æ 90, -180 –¥–æ 180).', true);
                console.warn("Invalid Lat/Lon for All conversion");
                return;
            }
            if (typeof proj4 === 'undefined' || typeof mgrs === 'undefined') {
                showResult('–ü–æ–º–∏–ª–∫–∞: –ù–µ –≤—Å—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –Ω–µ–º–æ–∂–ª–∏–≤–∞.', true);
                console.error("One or both libraries (Proj4js, MGRS) are undefined in convertLatLonToAll");
                return;
            }
            try {
                console.log("Attempting All conversions for:", lat, lon);
                // UTM
                const zone = Math.floor((lon + 180) / 6) + 1;
                const hemisphere = lat >= 0 ? 'N' : 'S';
                const utmProj = proj4(getUtmProjString(zone, hemisphere));
                const [easting, northing] = utmProj.forward([lon, lat]);
                // MGRS
                const mgrsCoord = mgrs.forward([lon, lat], 5);
                // USNG
                const usngCoord = formatMGRSToUSNG(mgrsCoord);

                // DDM
                const latAbsDDM = Math.abs(lat);
                const latDegDDM = Math.floor(latAbsDDM);
                const latMinDDM = (latAbsDDM - latDegDDM) * 60;
                const latDirDDM = lat >= 0 ? 'N' : 'S';
                const ddmLat = `${latDegDDM}¬∞ ${latMinDDM.toFixed(4)}'${latDirDDM}`;

                const lonAbsDDM = Math.abs(lon);
                const lonDegDDM = Math.floor(lonAbsDDM);
                const lonMinDDM = (lonAbsDDM - lonDegDDM) * 60;
                const lonDirDDM = lon >= 0 ? 'E' : 'W';
                const ddmLon = `${lonDegDDM}¬∞ ${lonMinDDM.toFixed(4)}'${lonDirDDM}`;

                // DMS
                const toDMS = (coord, isLat) => {
                    const absCoord = Math.abs(coord);
                    const degrees = Math.floor(absCoord);
                    const minutesFloat = (absCoord - degrees) * 60;
                    const minutes = Math.floor(minutesFloat);
                    const seconds = (minutesFloat - minutes) * 60;
                    let direction;
                    if (isLat) {
                        direction = coord >= 0 ? 'N' : 'S';
                    } else {
                        direction = coord >= 0 ? 'E' : 'W';
                    }
                    return `${degrees}¬∞ ${minutes}' ${seconds.toFixed(2)}''${direction}`;
                };
                const dmsLat = toDMS(lat, true);
                const dmsLon = toDMS(lon, false);

                const result = `
                    <h3>–í—Å—ñ —Ñ–æ—Ä–º–∞—Ç–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:</h3>
                    <p><strong>–®–∏—Ä–æ—Ç–∞ (DD):</strong> ${lat.toFixed(6)}¬∞ ${addCopyButton(lat.toFixed(6), '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                    <p><strong>–î–æ–≤–≥–æ—Ç–∞ (DD):</strong> ${lon.toFixed(6)}¬∞ ${addCopyButton(lon.toFixed(6), '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                    <p><strong>UTM:</strong> ${zone}${hemisphere} ${easting.toFixed(2)} ${northing.toFixed(2)} ${addCopyButton(`${zone}${hemisphere} ${easting.toFixed(2)} ${northing.toFixed(2)}`, '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                    <p><strong>MGRS:</strong> ${mgrsCoord} ${addCopyButton(mgrsCoord, '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                    <p><strong>USNG:</strong> ${usngCoord} ${addCopyButton(usngCoord, '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                    <p><strong>DDM:</strong> ${ddmLat} ${addCopyButton(ddmLat, '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                    <p><strong>DMS:</strong> ${dmsLat} ${addCopyButton(dmsLon, '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p> 
                `;
                showResult(result);
                showOnMap(lat, lon);
            } catch (error) {
                console.error("All Conversions Error:", error);
                showResult(`–ü–æ–º–∏–ª–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó: ${error.message}`, true);
            }
        }

        function convertLatLonToAllPrecisions() {
            console.log("convertLatLonToAllPrecisions called"); // –î–ª—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è
            const lat = parseFloat(document.getElementById('latInput').value);
            const lon = parseFloat(document.getElementById('lonInput').value);
            if (isNaN(lat) || lat < -90 || lat > 90 || isNaN(lon) || lon < -180 || lon > 180) {
                showResult('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –¥—ñ–π—Å–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ Lat/Lon (-90 –¥–æ 90, -180 –¥–æ 180).', true);
                console.warn("Invalid Lat/Lon for All Precisions conversion");
                return;
            }
            if (typeof mgrs === 'undefined') {
                showResult('–ü–æ–º–∏–ª–∫–∞: –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ MGRS –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è MGRS –Ω–µ–º–æ–∂–ª–∏–≤–∞.', true);
                console.error("MGRS library is undefined in convertLatLonToAllPrecisions");
                return;
            }
            try {
                console.log("Attempting MGRS All Precisions conversion for:", lat, lon);
                let result = '<h3>MGRS –∑ —Ä—ñ–∑–Ω–æ—é —Ç–æ—á–Ω—ñ—Å—Ç—é:</h3>';
                for (let precision = 0; precision <= 5; precision++) {
                    const mgrsCoord = mgrs.forward([lon, lat], precision);
                    const resolutionText = ['100–∫–º', '10–∫–º', '1–∫–º', '100–º', '10–º', '1–º'][precision];
                    result += `<p><strong>${resolutionText} (${precision} —Ü–∏—Ñ—Ä):</strong> ${mgrsCoord} ${addCopyButton(mgrsCoord, '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>`;
                }
                showResult(result);
                showOnMap(lat, lon);
            } catch (error) {
                console.error("MGRS All Precisions Conversion Error:", error);
                showResult(`–ü–æ–º–∏–ª–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó Lat/Lon –≤ MGRS (–≤—Å—ñ —Ç–æ—á–Ω–æ—Å—Ç—ñ): ${error.message}`, true);
            }
        }

        function convertUTMToLatLon() {
            console.log("convertUTMToLatLon called"); // –î–ª—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è
            const zoneStr = document.getElementById('utmZoneInput').value.trim();
            const easting = parseFloat(document.getElementById('utmEastingInput').value);
            const northing = parseFloat(document.getElementById('utmNorthingInput').value);
            if (!zoneStr || isNaN(easting) || isNaN(northing)) {
                showResult('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –≤—Å—ñ UTM –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ (–ó–æ–Ω–∞, Easting, Northing).', true);
                console.warn("Missing UTM inputs");
                return;
            }
            if (typeof proj4 === 'undefined') {
                showResult('–ü–æ–º–∏–ª–∫–∞: –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ Proj4js –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è UTM –Ω–µ–º–æ–∂–ª–∏–≤–∞.', true);
                console.error("Proj4js library is undefined in convertUTMToLatLon");
                return;
            }
            const zoneMatch = zoneStr.match(/^(\d+)([NnSs])$/);
            if (!zoneMatch) {
                showResult('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –∑–æ–Ω–∏ UTM (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 36N –∞–±–æ 34s).', true);
                console.warn("Invalid UTM zone format");
                return;
            }
            const zoneNum = parseInt(zoneMatch[1]);
            const hemisphere = zoneMatch[2].toUpperCase();
            try {
                console.log("Attempting UTM to LatLon conversion for:", zoneStr, easting, northing);
                const utmProj = proj4(getUtmProjString(zoneNum, hemisphere));
                const [lon, lat] = utmProj.inverse([easting, northing]);
                if (isNaN(lat) || lat < -90 || lat > 90 || isNaN(lon) || lon < -180 || lon > 180) {
                    showResult('–û—Ç—Ä–∏–º–∞–Ω—ñ Lat/Lon –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –ø–æ–∑–∞ –¥–æ–ø—É—Å—Ç–∏–º–∏–º–∏ –º–µ–∂–∞–º–∏. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤–≤—ñ–¥ UTM.', true);
                    console.error("Converted Lat/Lon out of bounds");
                    return;
                }
                const result = `
                    <h3>Lat/Lon –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</h3>
                    <p><strong>–®–∏—Ä–æ—Ç–∞ (DD):</strong> ${lat.toFixed(6)}¬∞ ${addCopyButton(lat.toFixed(6), '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                    <p><strong>–î–æ–≤–≥–æ—Ç–∞ (DD):</strong> ${lon.toFixed(6)}¬∞ ${addCopyButton(lon.toFixed(6), '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                `;
                showResult(result);
                showOnMap(lat, lon);
            } catch (error) {
                console.error("UTM to LatLon Conversion Error:", error);
                showResult(`–ü–æ–º–∏–ª–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó UTM –≤ Lat/Lon: ${error.message}`, true);
            }
        }

        function convertMGRSToLatLon() {
            console.log("convertMGRSToLatLon called"); // –î–ª—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è
            const mgrsCoord = document.getElementById('mgrsInput').value.trim();
            if (!mgrsCoord) {
                showResult('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å MGRS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏.', true);
                console.warn("Missing MGRS input");
                return;
            }
            if (typeof mgrs === 'undefined') {
                showResult('–ü–æ–º–∏–ª–∫–∞: –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ MGRS –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è MGRS –Ω–µ–º–æ–∂–ª–∏–≤–∞.', true);
                console.error("MGRS library is undefined in convertMGRSToLatLon");
                return;
            }
            const mgrsPattern = /^[0-9]{1,2}[A-Z][A-Z]{2}[0-9]*$/;
            if (!mgrsPattern.test(mgrsCoord)) {
                showResult('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç MGRS (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 36UYA1234567890).', true);
                console.warn("Invalid MGRS format");
                return;
            }
            try {
                console.log("Attempting MGRS to LatLon conversion for:", mgrsCoord);
                const [lon, lat] = mgrs.inverse(mgrsCoord);
                if (isNaN(lat) || lat < -90 || lat > 90 || isNaN(lon) || lon < -180 || lon > 180) {
                    showResult('–û—Ç—Ä–∏–º–∞–Ω—ñ Lat/Lon –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –ø–æ–∑–∞ –¥–æ–ø—É—Å—Ç–∏–º–∏–º–∏ –º–µ–∂–∞–º–∏. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤–≤—ñ–¥ MGRS.', true);
                    console.error("Converted Lat/Lon out of bounds from MGRS");
                    return;
                }
                const result = `
                    <h3>Lat/Lon –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</h3>
                    <p><strong>–®–∏—Ä–æ—Ç–∞ (DD):</strong> ${lat.toFixed(6)}¬∞ ${addCopyButton(lat.toFixed(6), '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                    <p><strong>–î–æ–≤–≥–æ—Ç–∞ (DD):</strong> ${lon.toFixed(6)}¬∞ ${addCopyButton(lon.toFixed(6), '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                `;
                showResult(result);
                showOnMap(lat, lon);
            } catch (error) {
                console.error("MGRS to LatLon Conversion Error:", error);
                showResult(`–ü–æ–º–∏–ª–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó MGRS –≤ Lat/Lon: ${error.message}`, true);
            }
        }

        function convertUSNGToLatLon() {
            console.log("convertUSNGToLatLon called");
            const usngCoord = document.getElementById('usngInput').value.trim();
            if (!usngCoord) {
                showResult('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å USNG –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏.', true);
                return;
            }
            if (typeof mgrs === 'undefined') {
                showResult('–ü–æ–º–∏–ª–∫–∞: –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ MGRS –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è USNG –Ω–µ–º–æ–∂–ª–∏–≤–∞.', true);
                return;
            }
            // mgrs.js inverse is flexible, it can usually handle spaces in USNG strings
            try {
                const [lon, lat] = mgrs.inverse(usngCoord); 
                if (isNaN(lat) || isNaN(lon) || lat < -90 || lat > 90 || lon < -180 || lon > 180) {
                    showResult('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç USNG –∞–±–æ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–∑–∞ –¥–æ–ø—É—Å—Ç–∏–º–∏–º–∏ –º–µ–∂–∞–º–∏. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤–≤—ñ–¥.', true);
                    return;
                }
                const result = `
                    <h3>Lat/Lon (DD) –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</h3>
                    <p><strong>–®–∏—Ä–æ—Ç–∞ (DD):</strong> ${lat.toFixed(6)}¬∞ ${addCopyButton(lat.toFixed(6), '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                    <p><strong>–î–æ–≤–≥–æ—Ç–∞ (DD):</strong> ${lon.toFixed(6)}¬∞ ${addCopyButton(lon.toFixed(6), '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                `;
                showResult(result);
                showOnMap(lat, lon);
            } catch (error) {
                console.error("USNG to LatLon Conversion Error:", error);
                showResult(`–ü–æ–º–∏–ª–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó USNG –≤ Lat/Lon: ${error.message}`, true);
            }
        }


        function convertDDMToLatLon() {
            console.log("convertDDMToLatLon called");
            const ddmLat = document.getElementById('ddmLatInput').value.trim();
            const ddmLon = document.getElementById('ddmLonInput').value.trim();

            if (!ddmLat || !ddmLon) {
                showResult('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –æ–±–∏–¥–≤—ñ DDM –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏.', true);
                return;
            }

            const parseDDM = (ddmString) => {
                const match = ddmString.match(/^(-?\d{1,3})¬∞\s*(\d{1,2}\.\d+)'([NSWE])$/i);
                if (!match) return NaN;

                let degrees = parseFloat(match[1]);
                let minutes = parseFloat(match[2]);
                const direction = match[3].toUpperCase();

                if (isNaN(degrees) || isNaN(minutes) || minutes >= 60 || minutes < 0) return NaN;

                let decimalDegrees = degrees + minutes / 60;
                if (direction === 'S' || direction === 'W') {
                    decimalDegrees *= -1;
                }
                return decimalDegrees;
            };

            try {
                const lat = parseDDM(ddmLat);
                const lon = parseDDM(ddmLon);

                if (isNaN(lat) || isNaN(lon) || lat < -90 || lat > 90 || lon < -180 || lon > 180) {
                    showResult('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç DDM –∞–±–æ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–∑–∞ –¥–æ–ø—É—Å—Ç–∏–º–∏–º–∏ –º–µ–∂–∞–º–∏. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤–≤—ñ–¥.', true);
                    return;
                }

                const result = `
                    <h3>Lat/Lon (DD) –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</h3>
                    <p><strong>–®–∏—Ä–æ—Ç–∞ (DD):</strong> ${lat.toFixed(6)}¬∞ ${addCopyButton(lat.toFixed(6), '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                    <p><strong>–î–æ–≤–≥–æ—Ç–∞ (DD):</strong> ${lon.toFixed(6)}¬∞ ${addCopyButton(lon.toFixed(6), '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                `;
                showResult(result);
                showOnMap(lat, lon);
            } catch (error) {
                console.error("DDM to LatLon Conversion Error:", error);
                showResult(`–ü–æ–º–∏–ª–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó DDM –≤ Lat/Lon: ${error.message}`, true);
            }
        }

        function convertDMSToLatLon() {
            console.log("convertDMSToLatLon called");
            const dmsLat = document.getElementById('dmsLatInput').value.trim();
            const dmsLon = document.getElementById('dmsLonInput').value.trim();

            if (!dmsLat || !dmsLon) {
                showResult('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –æ–±–∏–¥–≤—ñ DMS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏.', true);
                return;
            }

            const parseDMS = (dmsString) => {
                const match = dmsString.match(/^(-?\d{1,3})¬∞\s*(\d{1,2})'\s*(\d{1,2}(?:\.\d+)?)(?:''|"|‚Äú|‚Äù)([NSWE])$/i); // –î–æ–¥–∞–Ω–æ –æ–±—Ä–æ–±–∫—É —Ä—ñ–∑–Ω–∏—Ö —Å–∏–º–≤–æ–ª—ñ–≤ –¥–ª—è —Å–µ–∫—É–Ω–¥ (''|"|‚Äú|‚Äù)
                if (!match) return NaN;

                let degrees = parseFloat(match[1]);
                let minutes = parseFloat(match[2]);
                let seconds = parseFloat(match[3]);
                const direction = match[4].toUpperCase();

                if (isNaN(degrees) || isNaN(minutes) || isNaN(seconds) || minutes >= 60 || minutes < 0 || seconds >= 60 || seconds < 0) return NaN;

                let decimalDegrees = degrees + minutes / 60 + seconds / 3600;
                if (direction === 'S' || direction === 'W') {
                    decimalDegrees *= -1;
                }
                return decimalDegrees;
            };

            try {
                const lat = parseDMS(dmsLat);
                const lon = parseDMS(dmsLon);

                if (isNaN(lat) || isNaN(lon) || lat < -90 || lat > 90 || lon < -180 || lon > 180) {
                    showResult('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç DMS –∞–±–æ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–∑–∞ –¥–æ–ø—É—Å—Ç–∏–º–∏–º–∏ –º–µ–∂–∞–º–∏. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤–≤—ñ–¥.', true);
                    return;
                }

                const result = `
                    <h3>Lat/Lon (DD) –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</h3>
                    <p><strong>–®–∏—Ä–æ—Ç–∞ (DD):</strong> ${lat.toFixed(6)}¬∞ ${addCopyButton(lat.toFixed(6), '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                    <p><strong>–î–æ–≤–≥–æ—Ç–∞ (DD):</strong> ${lon.toFixed(6)}¬∞ ${addCopyButton(lon.toFixed(6), '–ö–æ–ø—ñ—é–≤–∞—Ç–∏')}</p>
                `;
                showResult(result);
                showOnMap(lat, lon);
            } catch (error) {
                console.error("DMS to LatLon Conversion Error:", error);
                showResult(`–ü–æ–º–∏–ª–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó DMS –≤ Lat/Lon: ${error.message}`, true);
            }
        }


        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –º–∞—Ä–∫–µ—Ä–∞ –Ω–∞ –∫–∞—Ä—Ç—ñ Google Maps. –¶—è —Ñ—É–Ω–∫—Ü—ñ—è –û–ë–û–í'–Ø–ó–ö–û–í–û –≥–ª–æ–±–∞–ª—å–Ω–∞.
        function showOnMap(lat, lon) {
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ Google Maps API —Ç–∞ –∫–∞—Ä—Ç–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ
            if (typeof google === 'undefined' || !map) {
                showResult('–ö–∞—Ä—Ç–∞ Google Maps –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤–∞—à API –∫–ª—é—á –∞–±–æ –∑\'—î–¥–Ω–∞–Ω–Ω—è.', true);
                return;
            }

            // –í–∏–¥–∞–ª—è—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –º–∞—Ä–∫–µ—Ä, —è–∫—â–æ –≤—ñ–Ω —ñ—Å–Ω—É—î
            if (currentMarker) {
                currentMarker.setMap(null); // –í–∏–¥–∞–ª—è—î–º–æ –º–∞—Ä–∫–µ—Ä –∑ –∫–∞—Ä—Ç–∏ Google Maps
            }

            const position = { lat: lat, lng: lon };

            // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π –º–∞—Ä–∫–µ—Ä Google Maps
            currentMarker = new google.maps.Marker({
                position: position,
                map: map,
                title: `Lat: ${lat.toFixed(6)}, Lon: ${lon.toFixed(6)}`
            });

            // –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–∞ –≤—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ —ñ–Ω—Ñ–æ-–≤—ñ–∫–Ω–æ (InfoWindow)
            const infowindow = new google.maps.InfoWindow({
                content: `<b>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</b><br>–®–∏—Ä–æ—Ç–∞: ${lat.toFixed(6)}¬∞<br>–î–æ–≤–≥–æ—Ç–∞: ${lon.toFixed(6)}¬∞`
            });
            infowindow.open(map, currentMarker);

            // –¶–µ–Ω—Ç—Ä—É—î–º–æ –∫–∞—Ä—Ç—É –Ω–∞ –º–∞—Ä–∫–µ—Ä—ñ
            map.setCenter(position);
            map.setZoom(13); // –ú–∞—Å—à—Ç–∞–± –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É

            // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –∫–∞—Ä—Ç–∏, —è–∫—â–æ –≤—ñ–Ω —â–µ –≤–∏–¥–∏–º–∏–π
            const mapPlaceholder = document.querySelector('.map-placeholder');
            if (mapPlaceholder && mapPlaceholder.style.display !== 'none') {
                mapPlaceholder.style.display = 'none';
            }
        }

        // –®–≤–∏–¥–∫—ñ –¥—ñ—ó —Ç–∞ –∑–∞–≥–∞–ª—å–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó (–º–∞—é—Ç—å –±—É—Ç–∏ –≥–ª–æ–±–∞–ª—å–Ω–∏–º–∏ –¥–ª—è onclick)
        function setKyivCoordinates() {
            document.getElementById('latInput').value = '50.4501';
            document.getElementById('lonInput').value = '30.5234';
            clearOtherInputs(); // –û—á–∏—Å—Ç–∏—Ç–∏ —ñ–Ω—à—ñ –ø–æ–ª—è –≤–≤–æ–¥—É
            validateInput();
            convertLatLonToAll(); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è
        }

        function setLvivCoordinates() {
            document.getElementById('latInput').value = '49.8397';
            document.getElementById('lonInput').value = '24.0297';
            clearOtherInputs(); // –û—á–∏—Å—Ç–∏—Ç–∏ —ñ–Ω—à—ñ –ø–æ–ª—è –≤–≤–æ–¥—É
            validateInput();
            convertLatLonToAll(); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è
        }

        function setOdesaCoordinates() {
            document.getElementById('latInput').value = '46.4825';
            document.getElementById('lonInput').value = '30.7233';
            clearOtherInputs(); // –û—á–∏—Å—Ç–∏—Ç–∏ —ñ–Ω—à—ñ –ø–æ–ª—è –≤–≤–æ–¥—É
            validateInput();
            convertLatLonToAll(); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è
        }

        function clearInputs() {
            document.getElementById('latInput').value = '';
            document.getElementById('lonInput').value = '';
            clearOtherInputs(); // –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ —ñ–Ω—à—ñ –ø–æ–ª—è
            document.getElementById('result').style.display = 'none';

            // –°–∫–∏–¥–∞–Ω–Ω—è —Å—Ç–∏–ª—ñ–≤ borders
            document.getElementById('latInput').style.borderColor = '#e0e0e0';
            document.getElementById('lonInput').style.borderColor = '#e0e0e0';
            document.getElementById('mgrsInput').style.borderColor = '#e0e0e0';
            document.getElementById('utmZoneInput').style.borderColor = '#e0e0e0';
            document.getElementById('utmEastingInput').style.borderColor = '#e0e0e0';
            document.getElementById('utmNorthingInput').style.borderColor = '#e0e0e0';
            document.getElementById('usngInput').style.borderColor = '#e0e0e0'; // New
            document.getElementById('ddmLatInput').style.borderColor = '#e0e0e0';
            document.getElementById('ddmLonInput').style.borderColor = '#e0e0e0';
            document.getElementById('dmsLatInput').style.borderColor = '#e0e0e0';
            document.getElementById('dmsLonInput').style.borderColor = '#e0e0e0';


            // –í–∏–¥–∞–ª–µ–Ω–Ω—è –º–∞—Ä–∫–µ—Ä–∞ –∑ –∫–∞—Ä—Ç–∏ Google Maps
            if (currentMarker) {
                currentMarker.setMap(null);
                currentMarker = null;
            }
            // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –∫–∞—Ä—Ç–∏ –∑–Ω–æ–≤—É
            document.querySelector('.map-placeholder').style.display = 'flex';
        }

        // –î–æ–ø–æ–º—ñ–∂–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—á–∏—â–µ–Ω–Ω—è –≤—Å—ñ—Ö –ø–æ–ª—ñ–≤, –∫—Ä—ñ–º Lat/Lon
        function clearOtherInputs() {
            document.getElementById('mgrsInput').value = '';
            document.getElementById('utmZoneInput').value = '';
            document.getElementById('utmEastingInput').value = '';
            document.getElementById('utmNorthingInput').value = '';
            document.getElementById('usngInput').value = ''; // New
            document.getElementById('ddmLatInput').value = '';
            document.getElementById('ddmLonInput').value = '';
            document.getElementById('dmsLatInput').value = '';
            document.getElementById('dmsLonInput').value = '';
        }

        function showOnMapFromInputs() {
            const lat = parseFloat(document.getElementById('latInput').value);
            const lon = parseFloat(document.getElementById('lonInput').value);

            if (isNaN(lat) || lat < -90 || lat > 90 || isNaN(lon) || lon < -180 || lon > 180) {
                showResult('–°–ø–æ—á–∞—Ç–∫—É –≤–≤–µ–¥—ñ—Ç—å –¥—ñ–π—Å–Ω—ñ Lat/Lon –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏, —â–æ–± –ø–æ–∫–∞–∑–∞—Ç–∏ —ó—Ö –Ω–∞ –∫–∞—Ä—Ç—ñ.', true);
                return;
            }
            showOnMap(lat, lon);
            showResult(`–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ ${lat.toFixed(6)}, ${lon.toFixed(6)} –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–æ –Ω–∞ –∫–∞—Ä—Ç—ñ`);
        }

        function getCurrentLocation() {
            if (!navigator.geolocation) {
                showResult('–ì–µ–æ–ª–æ–∫–∞—Ü—ñ—è –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è —Ü–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º', true);
                return;
            }

            const button = document.querySelector('.location-btn');
            const originalText = button.textContent;
            button.textContent = '–û—Ç—Ä–∏–º–∞–Ω–Ω—è...';
            button.disabled = true;

            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;

                    document.getElementById('latInput').value = lat.toFixed(6);
                    document.getElementById('lonInput').value = lon.toFixed(6);

                    clearOtherInputs(); // –û—á–∏—Å—Ç–∏—Ç–∏ —ñ–Ω—à—ñ –ø–æ–ª—è –≤–≤–æ–¥—É
                    convertLatLonToAll(); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è

                    button.textContent = originalText;
                    button.disabled = false;
                    showTemporaryMessage('–ü–æ—Ç–æ—á–Ω–µ –º—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –æ—Ç—Ä–∏–º–∞–Ω–æ', 'success');
                },
                function(error) {
                    let errorMessage = '–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = '–î–æ—Å—Ç—É–ø –¥–æ –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ. –ë—É–¥—å –ª–∞—Å–∫–∞, –¥–æ–∑–≤–æ–ª—å—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö –±—Ä–∞—É–∑–µ—Ä–∞.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = '–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–µ. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑ –ø—ñ–∑–Ω—ñ—à–µ.';
                            break;
                        case error.TIMEOUT:
                            errorMessage = '–ß–∞—Å –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó –≤–∏—á–µ—Ä–ø–∞–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑\'—î–¥–Ω–∞–Ω–Ω—è –∞–±–æ —Å–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.';
                            break;
                    }
                    showResult(errorMessage, true);
                    button.textContent = originalText;
                    button.disabled = false;
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }

        // --- DOMContentLoaded Listener: –¢—ñ–ª—å–∫–∏ –¥–ª—è –ø—Ä–∏—î–¥–Ω–∞–Ω–Ω—è —Å–ª—É—Ö–∞—á—ñ–≤ –ø–æ–¥—ñ–π, —è–∫—ñ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ DOM ---
        document.addEventListener('DOMContentLoaded', function() {
            // –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è WGS84 –ø—Ä–æ–µ–∫—Ü—ñ—ó –¥–ª—è proj4js
            // –¶–µ –±–µ–∑–ø–µ—á–Ω–æ —Ç—É—Ç, –æ—Å–∫—ñ–ª—å–∫–∏ proj4.js –≤–∂–µ –º–∞–≤ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏—Å—è.
            if (typeof proj4 !== 'undefined') {
                proj4.defs("EPSG:4326", "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs");
                console.log("Proj4js definitions loaded."); // –î–ª—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è
            } else {
                console.error("Proj4js library not loaded at DOMContentLoaded!");
                showTemporaryMessage("–ü–æ–º–∏–ª–∫–∞: –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ Proj4js –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è UTM –º–æ–∂–µ –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏.", 'error');
            }

            // –ü—Ä–∏—î–¥–Ω–∞–Ω–Ω—è —Å–ª—É—Ö–∞—á—ñ–≤ –ø–æ–¥—ñ–π –¥–æ –ø–æ–ª—ñ–≤ –≤–≤–æ–¥—É
            document.getElementById('latInput').addEventListener('input', validateInput);
            document.getElementById('lonInput').addEventListener('input', validateInput);
            document.getElementById('mgrsInput').addEventListener('input', validateMGRSInput);
            document.getElementById('usngInput').addEventListener('input', validateUSNGInput); // New
            document.getElementById('utmZoneInput').addEventListener('input', validateUTMInput);
            document.getElementById('utmEastingInput').addEventListener('input', validateUTMInput);
            document.getElementById('utmNorthingInput').addEventListener('input', validateUTMInput);
            document.getElementById('ddmLatInput').addEventListener('input', validateDDMInput);
            document.getElementById('ddmLonInput').addEventListener('input', validateDDMInput);
            document.getElementById('dmsLatInput').addEventListener('input', validateDMSInput);
            document.getElementById('dmsLonInput').addEventListener('input', validateDMSInput);


            // –ü—Ä–∏—î–¥–Ω–∞–Ω–Ω—è —Å–ª—É—Ö–∞—á—ñ–≤ –ø–æ–¥—ñ–π –¥–ª—è –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è Enter
            document.getElementById('latInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') convertLatLonToAll();
            });
            document.getElementById('lonInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') convertLatLonToAll();
            });
            document.getElementById('mgrsInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') convertMGRSToLatLon();
            });
            document.getElementById('usngInput').addEventListener('keypress', function(e) { // New
                if (e.key === 'Enter') convertUSNGToLatLon();
            });
            document.getElementById('utmZoneInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') convertUTMToLatLon();
            });
            document.getElementById('utmEastingInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') convertUTMToLatLon();
            });
            document.getElementById('utmNorthingInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') convertUTMToLatLon();
            });
            document.getElementById('ddmLatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') convertDDMToLatLon();
            });
            document.getElementById('ddmLonInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') convertDDMToLatLon();
            });
            document.getElementById('dmsLatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') convertDMSToLatLon();
            });
            document.getElementById('dmsLonInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') convertDMSToLatLon();
            });

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –≤–≤–æ–¥—É MGRS
            document.getElementById('mgrsInput').addEventListener('input', function(e) {
                e.target.value = e.target.value.toUpperCase().replace(/[^0-9A-Z]/g, '');
            });
             // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –≤–≤–æ–¥—É USNG (–≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞–π–≤–∏—Ö –ø—Ä–æ–±—ñ–ª—ñ–≤)
            document.getElementById('usngInput').addEventListener('input', function(e) {
                e.target.value = e.target.value.toUpperCase().replace(/\s+/g, ' ').trim();
            });
        });
    </script>
</body>
</html>
