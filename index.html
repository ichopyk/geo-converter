<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç Lat/Lon ‚Üî UTM ‚Üî MGRS</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.8.0/proj4.js"></script>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; }
    #map { height: 100vh; width: 100%; }
    .control-panel { position: absolute; top: 0; right: 0; width: 420px; height: 100vh; background: white; overflow-y: auto; padding: 20px; z-index: 2; }
    input, button { display: block; width: 100%; margin-bottom: 10px; padding: 10px; }
    .copy-btn { background: orange; color: white; border: none; padding: 6px 12px; cursor: pointer; }
    .result-section { background: #f4f4f4; padding: 10px; margin-top: 10px; }
    .error-message { background: #ffe6e6; color: #e74c3c; }
    .success-message { background: #e6ffe6; color: #27ae60; }
  </style>
</head>
<body>

  <div id="map"></div>

  <div class="control-panel">
    <h1>–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç</h1>

    <label>–®–∏—Ä–æ—Ç–∞:</label>
    <input type="text" id="latInput" placeholder="50.4501" oninput="validateInput()" />

    <label>–î–æ–≤–≥–æ—Ç–∞:</label>
    <input type="text" id="lonInput" placeholder="30.5234" oninput="validateInput()" />

    <button onclick="convertLatLonToAll()">‚Üí UTM + MGRS</button>
    <button onclick="convertLatLonToAllPrecisions()">‚Üí MGRS (–≤—Å—ñ —Ç–æ—á–Ω–æ—Å—Ç—ñ)</button>
    <button onclick="showOnMap()">–ü–æ–∫–∞–∑–∞—Ç–∏ –Ω–∞ –∫–∞—Ä—Ç—ñ</button>

    <label>MGRS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</label>
    <input type="text" id="mgrsInput" oninput="validateMGRSInput()" placeholder="36UYA1234567890" />
    <button onclick="convertMGRSToLatLon()">‚Üí Lat/Lon</button>

    <div style="margin-top: 20px;">
      <button onclick="setKyivCoordinates()">–ö–∏—ó–≤</button>
      <button onclick="setLvivCoordinates()">–õ—å–≤—ñ–≤</button>
      <button onclick="setOdesaCoordinates()">–û–¥–µ—Å–∞</button>
      <button onclick="clearInputs()">–û—á–∏—Å—Ç–∏—Ç–∏</button>
    </div>

    <div id="result" class="result-section" style="display:none;"></div>
  </div>

  <script>
    let gmap;
    let currentMarker = null;

    function initMap() {
      gmap = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 50.4501, lng: 30.5234 },
        zoom: 6,
      });
    }

    function showOnMap() {
      const lat = parseFloat(document.getElementById("latInput").value);
      const lon = parseFloat(document.getElementById("lonInput").value);
      if (isNaN(lat) || isNaN(lon)) {
        showTemporaryMessage("–ù–µ–≤—ñ—Ä–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏", "error");
        return;
      }
      const pos = { lat, lng: lon };
      if (currentMarker) currentMarker.setMap(null);
      currentMarker = new google.maps.Marker({ position: pos, map: gmap });
      gmap.setCenter(pos);
      gmap.setZoom(12);
    }

    function validateInput() {
      const lat = parseFloat(document.getElementById("latInput").value);
      const lon = parseFloat(document.getElementById("lonInput").value);
      document.getElementById("latInput").style.borderColor = (lat < -90 || lat > 90) ? "#e74c3c" : "#ccc";
      document.getElementById("lonInput").style.borderColor = (lon < -180 || lon > 180) ? "#e74c3c" : "#ccc";
    }

    function validateMGRSInput() {}

    function convertLatLonToAll() {
      const lat = parseFloat(document.getElementById("latInput").value);
      const lon = parseFloat(document.getElementById("lonInput").value);
      if (isNaN(lat) || isNaN(lon)) {
        showResult("–ù–µ–≤—ñ—Ä–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏", true);
        return;
      }
      const utm = mgrsConverter.latLonToUTM(lat, lon);
      const mgrs = mgrsConverter.latLonToMGRS(lat, lon);
      showResult(`UTM: ${utm.zone}${utm.hemisphere} ${utm.easting.toFixed(2)} ${utm.northing.toFixed(2)}<br>
        MGRS: ${mgrs} ${addCopyButton(mgrs, "–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏")}`);
    }

    function convertLatLonToAllPrecisions() {
      const lat = parseFloat(document.getElementById("latInput").value);
      const lon = parseFloat(document.getElementById("lonInput").value);
      if (isNaN(lat) || isNaN(lon)) {
        showResult("–ù–µ–≤—ñ—Ä–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏", true);
        return;
      }
      let output = "";
      for (let p = 1; p <= 5; p++) {
        const mgrs = mgrsConverter.latLonToMGRS(lat, lon, p);
        output += `${p * 2}-digit: ${mgrs} ${addCopyButton(mgrs, "üìã")}<br>`;
      }
      showResult(output);
    }

    function convertMGRSToLatLon() {
      try {
        const mgrs = document.getElementById("mgrsInput").value.trim();
        const [lat, lon] = mgrsConverter.mgrsToLatLon(mgrs);
        document.getElementById("latInput").value = lat.toFixed(6);
        document.getElementById("lonInput").value = lon.toFixed(6);
        showResult(`–®–∏—Ä–æ—Ç–∞: ${lat.toFixed(6)}, –î–æ–≤–≥–æ—Ç–∞: ${lon.toFixed(6)}`);
      } catch (e) {
        showResult("‚ùå –ù–µ–º–æ–∂–ª–∏–≤–æ —Ä–æ–∑–ø—ñ–∑–Ω–∞—Ç–∏ MGRS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏", true);
      }
    }

    function setKyivCoordinates() {
      document.getElementById("latInput").value = "50.4501";
      document.getElementById("lonInput").value = "30.5234";
    }

    function setLvivCoordinates() {
      document.getElementById("latInput").value = "49.8397";
      document.getElementById("lonInput").value = "24.0297";
    }

    function setOdesaCoordinates() {
      document.getElementById("latInput").value = "46.4825";
      document.getElementById("lonInput").value = "30.7233";
    }

    function clearInputs() {
      ['latInput', 'lonInput', 'mgrsInput'].forEach(id => document.getElementById(id).value = '');
      document.getElementById("result").style.display = "none";
    }

    function showResult(content, isError = false) {
      const div = document.getElementById("result");
      div.innerHTML = content;
      div.style.display = "block";
      div.className = `result-section ${isError ? "error-message" : ""}`;
    }

    function showTemporaryMessage(message, type) {
      const msg = document.createElement("div");
      msg.className = type === "success" ? "success-message" : "error-message";
      msg.innerText = message;
      msg.style.position = "fixed";
      msg.style.top = "20px";
      msg.style.right = "20px";
      msg.style.padding = "10px";
      msg.style.zIndex = 9999;
      document.body.appendChild(msg);
      setTimeout(() => msg.remove(), 3000);
    }

    function addCopyButton(text, label) {
      return `<button class="copy-btn" onclick="copyToClipboard('${text}')">${label}</button>`;
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        showTemporaryMessage("–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!", "success");
      });
    }

    // === MGRSConverter ===
    class MGRSConverter {
      latLonToUTM(lat, lon) {
        const zone = Math.floor((lon + 180) / 6) + 1;
        const hemisphere = lat >= 0 ? 'N' : 'S';
        const projStr = `+proj=utm +zone=${zone} +${hemisphere === 'N' ? '' : 'south '}+datum=WGS84`;
        const [easting, northing] = proj4('WGS84', projStr, [lon, lat]);
        return { zone, hemisphere, easting, northing };
      }

      latLonToMGRS(lat, lon, precision = 5) {
        const utm = this.latLonToUTM(lat, lon);
        const e100kLetters = "ABCDEFGHJKLMNPQRSTUVWXYZ";
        const n100kLetters = "ABCDEFGHJKLMNPQRSTUV";
        const zone = utm.zone;
        const e100k = Math.floor(utm.easting / 100000);
        const n100k = Math.floor(utm.northing / 100000) % 20;
        const eLetter = e100kLetters[(zone - 1) % 3 * 8 + e100k];
        const nLetter = n100kLetters[(zone % 2) * 5 + n100k % 20];
        const set = Math.pow(10, 5 - precision);
        const e = Math.floor(utm.easting % 100000 / set).toString().padStart(precision, '0');
        const n = Math.floor(utm.northing % 100000 / set).toString().padStart(precision, '0');
        return `${zone}${utm.hemisphere}${eLetter}${nLetter}${e}${n}`;
      }

      mgrsToLatLon(mgrs) {
        const regex = /^(\d{1,2})([NS])([A-Z])([A-Z])(\d{2,10})$/i;
        const m = mgrs.toUpperCase().replace(/\s/g, "").match(/^(\d{1,2})([NS])([A-Z]{2})(\d{2,10})$/);
        if (!m) throw new Error("Invalid MGRS");

        const zone = parseInt(m[1], 10);
        const hemisphere = m[2];
        const grid = m[3];
        const numbers = m[4];
        const precision = numbers.length / 2;
        const easting = parseInt(numbers.substring(0, precision).padEnd(5, '0'), 10);
        const northing = parseInt(numbers.substring(precision).padEnd(5, '0'), 10);

        const projStr = `+proj=utm +zone=${zone} ${hemisphere === 'S' ? '+south' : ''} +datum=WGS84`;
        const [lon, lat] = proj4(projStr, 'WGS84', [easting, northing]);
        return [lat, lon];
      }
    }

    const mgrsConverter = new MGRSConverter();
  </script>

  <!-- Google Maps API -->
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBwGrlOp-k99i4mj_q7v9uTxzXmEF9-GWM&callback=initMap"></script>
</body>
</html>












