<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç Lat/Lon ‚Üî UTM ‚Üî MGRS</title>

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBwGrlOp-k99i4mj_q7v9uTxzXmEF9-GWM&callback=initMap"></script>

    <script src="mgrs.min.js"></script> <script src="proj4.js"></script>   <style>
        /* –í–µ—Å—å –≤–∞—à CSS –∫–æ–¥ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –±–µ–∑ –∑–º—ñ–Ω */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            height: 100vh;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .main-container {
            display: flex;
            height: 100vh;
        }

        #map {
            flex: 1;
            height: 100%;
            position: relative;
        }

        .control-panel {
            width: 420px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-left: 1px solid rgba(0, 0, 0, 0.1);
            padding: 25px;
            overflow-y: auto;
            box-shadow: -5px 0 20px rgba(0, 0, 0, 0.15);
        }

        .control-panel h1 {
            font-size: 22px;
            margin-bottom: 25px;
            color: #2c3e50;
            text-align: center;
            font-weight: 600;
        }

        .input-group {
            margin-bottom: 18px;
        }

        .input-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #34495e;
            font-size: 14px;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .button-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 25px;
        }

        button {
            padding: 14px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .mgrs-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid #ecf0f1;
        }

        .mgrs-section h3 {
            margin-bottom: 18px;
            color: #2c3e50;
            font-size: 18px;
            font-weight: 600;
        }

        .result-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 1px solid #dee2e6;
            font-size: 14px;
            line-height: 1.6;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .result-section strong {
            color: #2c3e50;
        }

        .result-section small {
            color: #6c757d;
            font-style: italic;
        }

        .map-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .map-placeholder::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.3;
        }

        .map-controls {
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 12px;
            border-radius: 8px;
            font-size: 13px;
            color: #6c757d;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .quick-actions {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #ecf0f1;
        }

        .quick-actions h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 16px;
            font-weight: 600;
        }

        .quick-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .quick-btn {
            padding: 8px 12px;
            font-size: 12px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 80px;
        }

        .quick-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .format-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #ecf0f1;
        }

        .format-section h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 16px;
            font-weight: 600;
        }

        .format-examples {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            color: #6c757d;
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }

            #map {
                height: 40%;
            }

            .control-panel {
                width: 100%;
                height: 60%;
            }

            .map-controls {
                top: auto;
                bottom: 15px;
                left: 15px;
                right: 15px;
            }
        }

        .copy-btn {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3);
        }

        .error-message {
            color: #e74c3c;
            background: #ffebee;
            padding: 10px;
            border-radius: 6px;
            border-left: 4px solid #e74c3c;
        }

        .success-message {
            color: #27ae60;
            background: #e8f5e8;
            padding: 10px;
            border-radius: 6px;
            border-left: 4px solid #27ae60;
        }

        .utm-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid #ecf0f1;
        }

        .utm-section h3 {
            margin-bottom: 18px;
            color: #2c3e50;
            font-size: 18px;
            font-weight: 600;
        }

        .precision-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .precision-btn {
            padding: 6px 10px;
            font-size: 11px;
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .precision-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(142, 68, 173, 0.3);
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div id="map">
            <div class="map-placeholder">
                <div>
                    <div style="margin-bottom: 10px;">üó∫Ô∏è –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –∫–∞—Ä—Ç–∞</div>
                    <div style="font-size: 14px; opacity: 0.8;">–ö–ª—ñ–∫–Ω—ñ—Ç—å –Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –¥–ª—è —ó—Ö –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è</div>
                </div>
            </div>
        </div>

        <div class="control-panel">
            <h1>–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç</h1>

            <div class="input-group">
                <label for="latInput">–®–∏—Ä–æ—Ç–∞:</label>
                <input type="text" id="latInput" placeholder="50.4501" oninput="validateInput()">
            </div>

            <div class="input-group">
                <label for="lonInput">–î–æ–≤–≥–æ—Ç–∞:</label>
                <input type="text" id="lonInput" placeholder="30.5234" oninput="validateInput()">
            </div>

            <div class="button-group">
                <button onclick="convertLatLonToUTM()">‚Üí UTM</button>
                <button onclick="convertLatLonToMGRS()">‚Üí MGRS</button>
                <button onclick="convertLatLonToAll()">‚Üí UTM + MGRS</button>
                <button onclick="convertLatLonToAllPrecisions()">‚Üí MGRS (–≤—Å—ñ —Ç–æ—á–Ω–æ—Å—Ç—ñ)</button>
                <button onclick="showOnMapFromInputs()">–ü–æ–∫–∞–∑–∞—Ç–∏ –Ω–∞ –∫–∞—Ä—Ç—ñ</button>
            </div>

            <div class="utm-section">
                <h3>–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –∑ UTM</h3>
                <div class="input-group">
                    <label for="utmZoneInput">–ó–æ–Ω–∞ UTM:</label>
                    <input type="text" id="utmZoneInput" placeholder="36N">
                </div>
                <div class="input-group">
                    <label for="utmEastingInput">Easting:</label>
                    <input type="text" id="utmEastingInput" placeholder="123456">
                </div>
                <div class="input-group">
                    <label for="utmNorthingInput">Northing:</label>
                    <input type="text" id="utmNorthingInput" placeholder="5123456">
                </div>
                <div class="button-group">
                    <button onclick="convertUTMToLatLon()">‚Üí Lat/Lon</button>
                </div>
            </div>

            <div class="mgrs-section">
                <h3>–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –∑ MGRS</h3>
                <div class="input-group">
                    <label for="mgrsInput">MGRS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</label>
                    <input type="text" id="mgrsInput" placeholder="36UYA1234567890" oninput="validateMGRSInput()">
                </div>
                <div class="button-group">
                    <button onclick="convertMGRSToLatLon()">‚Üí Lat/Lon</button>
                </div>
            </div>

            <div class="quick-actions">
                <h3>–®–≤–∏–¥–∫—ñ –¥—ñ—ó</h3>
                <div class="quick-buttons">
                    <button class="quick-btn" onclick="setKyivCoordinates()">–ö–∏—ó–≤</button>
                    <button class="quick-btn" onclick="setLvivCoordinates()">–õ—å–≤—ñ–≤</button>
                    <button class="quick-btn" onclick="setOdesaCoordinates()">–û–¥–µ—Å–∞</button>
                    <button class="quick-btn" onclick="clearInputs()">–û—á–∏—Å—Ç–∏—Ç–∏</button>
                    <button class="quick-btn location-btn" onclick="getCurrentLocation()">–ú–æ—î –º—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è</button>
                </div>
            </div>

            <div class="format-section">
                <h3>–§–æ—Ä–º–∞—Ç–∏ –≤–≤–æ–¥—É</h3>
                <div class="format-examples">
                    <strong>Lat/Lon:</strong> 50.4501, 30.5234<br>
                    <strong>UTM:</strong> 36N 123456 5123456<br>
                    <strong>MGRS:</strong> 36UYA1234567890<br>
                    <strong>–ü—Ä–∏–∫–ª–∞–¥–∏:</strong><br>
                    ‚Ä¢ –î–µ—Å—è—Ç–∫–æ–≤—ñ –≥—Ä–∞–¥—É—Å–∏: 50.4501<br>
                    ‚Ä¢ MGRS –ø–æ–≤–Ω–∏–π: 36UYA1234567890<br>
                    ‚Ä¢ MGRS —Å–∫–æ—Ä–æ—á–µ–Ω–∏–π: 36UYA12345678
                </div>
            </div>

            <div id="result" class="result-section" style="display: none;"></div>
        </div>
    </div>

    <div class="map-controls">
        üí° –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –±—É–¥—É—Ç—å –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω—ñ –Ω–∞ –∫–∞—Ä—Ç—ñ –ø—ñ—Å–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ –¥–ª—è Google Maps
        let map = null;
        let currentMarker = null;

        // Callback —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è Google Maps API.
        // –¶—è —Ñ—É–Ω–∫—Ü—ñ—è –û–ë–û–í'–Ø–ó–ö–û–í–û –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ—é
        // —ñ –Ω–µ –æ–±–≥–æ—Ä–Ω—É—Ç–æ—é –≤ DOMContentLoaded, –æ—Å–∫—ñ–ª—å–∫–∏ —ó—ó –≤–∏–∫–ª–∏–∫–∞—î API.
        function initMap() {
            // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –∫–∞—Ä—Ç–∏ –æ–¥—Ä–∞–∑—É, —è–∫ —Ç—ñ–ª—å–∫–∏ —Ñ—É–Ω–∫—Ü—ñ—è initMap –≤–∏–∫–ª–∏–∫–∞–Ω–∞
            const mapPlaceholder = document.querySelector('.map-placeholder');
            if (mapPlaceholder) {
                mapPlaceholder.style.display = 'none';
            }

            // –¶–µ–Ω—Ç—Ä –∫–∞—Ä—Ç–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ö–∏—ó–≤)
            const defaultLatLng = { lat: 50.4501, lng: 30.5234 };

            map = new google.maps.Map(document.getElementById('map'), {
                center: defaultLatLng,
                zoom: 6, // –ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Ä—ñ–≤–µ–Ω—å –º–∞—Å—à—Ç–∞–±—É
                mapTypeId: 'roadmap' // –¢–∏–ø –∫–∞—Ä—Ç–∏: 'roadmap', 'satellite', 'hybrid', 'terrain'
            });

            // –î–æ–¥–∞—î–º–æ —Å–ª—É—Ö–∞—á –ø–æ–¥—ñ–π –¥–ª—è –∫–ª—ñ–∫—É –Ω–∞ –∫–∞—Ä—Ç—É
            map.addListener("click", (e) => {
                const clickedLat = e.latLng.lat();
                const clickedLon = e.latLng.lng();
                document.getElementById('latInput').value = clickedLat.toFixed(6);
                document.getElementById('lonInput').value = clickedLon.toFixed(6);
                validateInput();
                convertLatLonToAll(); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –ø–æ –∫–ª—ñ–∫—É
            });

            console.log("Google Maps initialized.");
        }

        // –í—Å—ñ —ñ–Ω—à—ñ JavaScript-—Ñ—É–Ω–∫—Ü—ñ—ó –º–æ–∂—É—Ç—å –∑–∞–ª–∏—à–∞—Ç–∏—Å—è –≤ DOMContentLoaded,
        // –∞–±–æ –±—É—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–∏–º–∏ –¥–æ –Ω—å–æ–≥–æ, —è–∫—â–æ –≤–æ–Ω–∏ —î –≥–ª–æ–±–∞–ª—å–Ω–∏–º–∏.
        document.addEventListener('DOMContentLoaded', function() {
            // –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è WGS84 –ø—Ä–æ–µ–∫—Ü—ñ—ó –¥–ª—è proj4js
            if (typeof proj4 !== 'undefined') {
                proj4.defs("EPSG:4326", "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs");
            } else {
                console.error("Proj4js library not loaded!");
                showTemporaryMessage("–ü–æ–º–∏–ª–∫–∞: –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ Proj4js –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è UTM –º–æ–∂–µ –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏.", 'error');
            }

            // –î–æ–¥–∞–≤–∞–Ω–Ω—è —Å–ª—É—Ö–∞—á—ñ–≤ –ø–æ–¥—ñ–π –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –≤–≤–æ–¥—É
            document.getElementById('latInput').addEventListener('input', validateInput);
            document.getElementById('lonInput').addEventListener('input', validateInput);
            document.getElementById('mgrsInput').addEventListener('input', validateMGRSInput);
            document.getElementById('utmZoneInput').addEventListener('input', validateUTMInput);
            document.getElementById('utmEastingInput').addEventListener('input', validateUTMInput);
            document.getElementById('utmNorthingInput').addEventListener('input', validateUTMInput);

            // –î–æ–¥–∞–≤–∞–Ω–Ω—è —Å–ª—É—Ö–∞—á—ñ–≤ –ø–æ–¥—ñ–π –¥–ª—è –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è Enter
            document.getElementById('latInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') convertLatLonToAll();
            });
            document.getElementById('lonInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') convertLatLonToAll();
            });
            document.getElementById('mgrsInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') convertMGRSToLatLon();
            });
            document.getElementById('utmZoneInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') convertUTMToLatLon();
            });
            document.getElementById('utmEastingInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') convertUTMToLatLon();
            });
            document.getElementById('utmNorthingInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') convertUTMToLatLon();
            });

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –≤–≤–æ–¥—É MGRS
            document.getElementById('mgrsInput').addEventListener('input', function(e) {
                e.target.value = e.target.value.toUpperCase().replace(/[^0-9A-Z]/g, '');
            });
        });

        // Helper function to display results
        function showResult(content, isError = false) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = content;
            resultDiv.style.display = 'block';

            if (isError) {
                resultDiv.className = 'result-section error-message';
            } else {
                resultDiv.className = 'result-section';
            }
        }

        // Helper function to add copy buttons
        function addCopyButton(text, label) {
            return `<button class="copy-btn" onclick="copyToClipboard('${text}')">${label}</button>`;
        }

        // Helper function for copy to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                showTemporaryMessage('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!', 'success');
            }, function() {
                showTemporaryMessage('–ü–æ–º–∏–ª–∫–∞ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è', 'error');
            });
        }

        // Helper function for temporary messages
        function showTemporaryMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
            messageDiv.textContent = message;
            messageDiv.style.position = 'fixed';
            messageDiv.style.top = '20px';
            messageDiv.style.right = '20px';
            messageDiv.style.zIndex = '9999';
            messageDiv.style.padding = '10px 20px';
            messageDiv.style.borderRadius = '8px';
            messageDiv.style.fontSize = '14px';
            messageDiv.style.fontWeight = '600';
            document.body.appendChild(messageDiv);

            setTimeout(() => {
                document.body.removeChild(messageDiv);
            }, 3000);
        }

        // Validation functions (–±–µ–∑ –∑–º—ñ–Ω)
        function validateInput() {
            const lat = document.getElementById('latInput').value;
            const lon = document.getElementById('lonInput').value;

            if (lat) {
                const latNum = parseFloat(lat);
                if (isNaN(latNum) || latNum < -90 || latNum > 90) {
                    document.getElementById('latInput').style.borderColor = '#e74c3c';
                } else {
                    document.getElementById('latInput').style.borderColor = '#27ae60';
                }
            } else {
                document.getElementById('latInput').style.borderColor = '#e0e0e0';
            }

            if (lon) {
                const lonNum = parseFloat(lon);
                if (isNaN(lonNum) || lonNum < -180 || lonNum > 180) {
                    document.getElementById('lonInput').style.borderColor = '#e74c3c';
                } else {
                    document.getElementById('lonInput').style.borderColor = '#27ae60';
                }
            } else {
                document.getElementById('lonInput').style.borderColor = '#e0e0e0';
            }
        }

        function validateMGRSInput() {
            const mgrsInput = document.getElementById('mgrsInput').value.trim().toUpperCase();
            const mgrsPattern = /^[0-9]{1,2}[A-Z][A-Z]{2}[0-9]{2,10}$/;

            if (mgrsInput) {
                if (mgrsPattern.test(mgrsInput)) {
                    document.getElementById('mgrsInput').style.borderColor = '#27ae60';
                } else {
                    document.getElementById('mgrsInput').style.borderColor = '#e74c3c';
                }
            } else {
                document.getElementById('mgrsInput').style.borderColor = '#e0e0e0';
            }
        }

        function validateUTMInput() {
            const zone = document.getElementById('utmZoneInput').value.trim();
            const easting = document.getElementById('utmEastingInput').value;
            const northing = document.getElementById('utmNorthingInput').value;

            const zonePattern = /^[0-9]{1,2}[NnSs]$/;

            if (zone) {
                if (zonePattern.test(zone)) {
                    document.getElementById('utmZoneInput').style.borderColor = '#27ae60';
                } else {
                    document.getElementById('utmZoneInput').style.borderColor = '#e74c3c';
                }
            } else {
                document.getElementById('utmZoneInput').style.borderColor = '#e0e0e0';
            }

            if (easting) {
                const eastingNum = parseFloat(easting);
                if (isNaN(eastingNum) || eastingNum < 100000 || eastingNum > 900000) {
                    document.getElementById('utmEastingInput').style.borderColor = '#e74c3c';
                } else {
                    document.getElementById('utmEastingInput').style.borderColor = '#27ae60';
                }
            } else {
                document.getElementById('utmEastingInput').style.borderColor = '#e0e0e0';
            }

            if (northing) {
                const northingNum = parseFloat(northing);
                if (isNaN(northingNum) || northingNum < 0 || northingNum > 10000000) {
                    document.getElementById('utmNorthingInput').style.borderColor = '#e74c3c';
                } else {
                    document.getElementById('utmNorthingInput').style.borderColor = '#27ae60';
                }
            } else {
                document.getElementById('utmNorthingInput').style.borderColor = '#e0e0e0';
            }
        }

        // --- Conversion Functions (–±–µ–∑ –∑–º—ñ–Ω, –∫—Ä—ñ–º –∫–æ–Ω—Å–æ–ª—å–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫) ---
        // (–û—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∏ –≤–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å typeof –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫, —Ü–µ –æ–∫.)

        // ... –≤—Å—ñ –≤–∞—à—ñ —Ñ—É–Ω–∫—Ü—ñ—ó convertLatLonToUTM, convertLatLonToMGRS, convertLatLonToAll,
        // convertLatLonToAllPrecisions, convertUTMToLatLon, convertMGRSToLatLon,
        // setKyivCoordinates, setLvivCoordinates, setOdesaCoordinates, getCurrentLocation
        // –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –±–µ–∑ –∑–º—ñ–Ω ...


        // Google Maps Specific showOnMap function
        function showOnMap(lat, lon) {
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ Google Maps API —Ç–∞ –∫–∞—Ä—Ç–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ
            if (typeof google === 'undefined' || !map) {
                showResult('–ö–∞—Ä—Ç–∞ Google Maps –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤–∞—à API –∫–ª—é—á –∞–±–æ –∑\'—î–¥–Ω–∞–Ω–Ω—è.', true);
                return;
            }

            // –í–∏–¥–∞–ª—è—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –º–∞—Ä–∫–µ—Ä, —è–∫—â–æ –≤—ñ–Ω —ñ—Å–Ω—É—î
            if (currentMarker) {
                currentMarker.setMap(null); // –í–∏–¥–∞–ª—è—î–º–æ –º–∞—Ä–∫–µ—Ä –∑ –∫–∞—Ä—Ç–∏ Google Maps
            }

            const position = { lat: lat, lng: lon };

            // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π –º–∞—Ä–∫–µ—Ä Google Maps
            currentMarker = new google.maps.Marker({
                position: position,
                map: map,
                title: `Lat: ${lat.toFixed(6)}, Lon: ${lon.toFixed(6)}`
            });

            // –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–∞ –≤—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ —ñ–Ω—Ñ–æ-–≤—ñ–∫–Ω–æ (InfoWindow)
            const infowindow = new google.maps.InfoWindow({
                content: `<b>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</b><br>–®–∏—Ä–æ—Ç–∞: ${lat.toFixed(6)}¬∞<br>–î–æ–≤–≥–æ—Ç–∞: ${lon.toFixed(6)}¬∞`
            });
            infowindow.open(map, currentMarker);

            // –¶–µ–Ω—Ç—Ä—É—î–º–æ –∫–∞—Ä—Ç—É –Ω–∞ –º–∞—Ä–∫–µ—Ä—ñ
            map.setCenter(position);
            map.setZoom(13); // –ú–∞—Å—à—Ç–∞–± –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É

            // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –∫–∞—Ä—Ç–∏, —è–∫—â–æ –≤—ñ–Ω —â–µ –≤–∏–¥–∏–º–∏–π
            const mapPlaceholder = document.querySelector('.map-placeholder');
            if (mapPlaceholder && mapPlaceholder.style.display !== 'none') {
                mapPlaceholder.style.display = 'none';
            }
        }

        // ... —ñ–Ω—à—ñ —Ñ—É–Ω–∫—Ü—ñ—ó (clearInputs, showOnMapFromInputs, getCurrentLocation) ...
        // –û–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è clearInputs
        function clearInputs() {
            document.getElementById('latInput').value = '';
            document.getElementById('lonInput').value = '';
            document.getElementById('mgrsInput').value = '';
            document.getElementById('utmZoneInput').value = '';
            document.getElementById('utmEastingInput').value = '';
            document.getElementById('utmNorthingInput').value = '';
            document.getElementById('result').style.display = 'none';

            // Reset border colors
            document.getElementById('latInput').style.borderColor = '#e0e0e0';
            document.getElementById('lonInput').style.borderColor = '#e0e0e0';
            document.getElementById('mgrsInput').style.borderColor = '#e0e0e0';
            document.getElementById('utmZoneInput').style.borderColor = '#e0e0e0';
            document.getElementById('utmEastingInput').style.borderColor = '#e0e0e0';
            document.getElementById('utmNorthingInput').style.borderColor = '#e0e0e0';

            // Remove marker from map (if it's Google Maps marker)
            if (currentMarker) {
                currentMarker.setMap(null); // Remove Google Maps marker
                currentMarker = null;
            }
            // Show the map placeholder again
            document.querySelector('.map-placeholder').style.display = 'flex';
        }

        function showOnMapFromInputs() {
            const lat = parseFloat(document.getElementById('latInput').value);
            const lon = parseFloat(document.getElementById('lonInput').value);

            if (isNaN(lat) || lat < -90 || lat > 90 || isNaN(lon) || lon < -180 || lon > 180) {
                showResult('–°–ø–æ—á–∞—Ç–∫—É –≤–≤–µ–¥—ñ—Ç—å –¥—ñ–π—Å–Ω—ñ Lat/Lon –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏, —â–æ–± –ø–æ–∫–∞–∑–∞—Ç–∏ —ó—Ö –Ω–∞ –∫–∞—Ä—Ç—ñ.', true);
                return;
            }
            showOnMap(lat, lon);
            showResult(`–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ ${lat.toFixed(6)}, ${lon.toFixed(6)} –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–æ –Ω–∞ –∫–∞—Ä—Ç—ñ`);
        }

        function getCurrentLocation() {
            if (!navigator.geolocation) {
                showResult('–ì–µ–æ–ª–æ–∫–∞—Ü—ñ—è –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è —Ü–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º', true);
                return;
            }

            const button = document.querySelector('.location-btn');
            const originalText = button.textContent;
            button.textContent = '–û—Ç—Ä–∏–º–∞–Ω–Ω—è...';
            button.disabled = true;

            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;

                    document.getElementById('latInput').value = lat.toFixed(6);
                    document.getElementById('lonInput').value = lon.toFixed(6);

                    convertLatLonToAll();

                    button.textContent = originalText;
                    button.disabled = false;
                    showTemporaryMessage('–ü–æ—Ç–æ—á–Ω–µ –º—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –æ—Ç—Ä–∏–º–∞–Ω–æ', 'success');
                },
                function(error) {
                    let errorMessage = '–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = '–î–æ—Å—Ç—É–ø –¥–æ –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ. –ë—É–¥—å –ª–∞—Å–∫–∞, –¥–æ–∑–≤–æ–ª—å—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö –±—Ä–∞—É–∑–µ—Ä–∞.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = '–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–µ. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑ –ø—ñ–∑–Ω—ñ—à–µ.';
                            break;
                        case error.TIMEOUT:
                            errorMessage = '–ß–∞—Å –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó –≤–∏—á–µ—Ä–ø–∞–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑\'—î–¥–Ω–∞–Ω–Ω—è –∞–±–æ —Å–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.';
                            break;
                    }
                    showResult(errorMessage, true);
                    button.textContent = originalText;
                    button.disabled = false;
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }
    </script>
</body>
</html>
